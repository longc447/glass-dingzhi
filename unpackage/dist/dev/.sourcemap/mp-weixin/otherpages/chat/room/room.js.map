{"version":3,"sources":["uni-app:///main.js","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?1a10","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?26df","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?4147","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?fb0a","uni-app:///otherpages/chat/room/room.vue","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?37f8","webpack:////Users/longchu/Documents/接单/改客服源码/otherpages/chat/room/room.vue?e596"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","chatMessage","data","emjoyList","emjoyShow","chatMore","formData","content","goods_id","order_id","image","isNetWork","send","messageList","page","isAll","isLoading","showLoading","jumpBottom","scrollTop","scrollPosition","siteId","skuId","orderId","siteName","shopInfo","userInfo","style","inputFirst","inputShow","inputOffsetBottom","goods_type","promotion_name","promotion_id","mixins","computed","chatBottom","onLoad","info","title","setTimeout","uni","onReady","methods","onEditorReady","select","context","exec","onEditorinput","success","openChatMore","getShopInfo","url","site_id","getUserInfo","getChatList","that","console","servicer_id","limit","res","startId","id","isItMe","contentType","sku_id","newArr","obj","setPageScrollTo","createSelectorQuery","in","view","duration","query","boundingClientRect","sendGood","e","index","sendOrder","sendMsg","_type","content_type","relate_data","complete","message","error","joinData","addType","sendStatus","hideLoadTips","flag","onPageScroll","inputFocus","closePopWindow","openEmjoy","addEmjoy","emjoy","html","addImg","path","beforeDestroy","clearInterval"],"mappings":";;;;;;;;;;kDAAA;;;AAGA;AACA,qG,8FAHA;AACAA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC,CAGAC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACyN;AACzN,gBAAgB,uNAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAA+2B,CAAgB,g0BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC8Cn4B;;AAEA;AACA,wG;AACA;EACAC;IACAC,wBADA,EADA;;EAIAC,IAJA,kBAIA;IACA;MACAC,mCADA;MAEAC,gBAFA;MAGAC,eAHA;MAIAC;QACAC,WADA;QAEAC,WAFA;QAGAC,WAHA;QAIAC,SAJA,EAJA;;MAUAC,gBAVA;MAWAC,WAXA;;MAaAC,eAbA;MAcAC,OAdA;MAeAC,YAfA;MAgBAC,YAhBA;MAiBAC,kBAjBA,EAiBA;;MAEAC,gBAnBA;MAoBAC,YApBA;MAqBAC,iBArBA;;MAuBAC,SAvBA,EAuBA;MACAC,QAxBA,EAwBA;MACAC,UAzBA,EAyBA;MACAC,YA1BA,EA0BA;MACAC,YA3BA;MA4BAC,YA5BA;MA6BAC,SA7BA,EA6BA;MACAC,aA9BA;MA+BAC,gBA/BA;MAgCAC,oBAhCA;MAiCAC;QACAC,kBADA;QAEAC,gBAFA,EAjCA;;;EAsCA,CA3CA;EA4CAC,oDA5CA;EA6CAC;IACAC,UADA,wBACA;MACA;IACA,CAHA,EA7CA;;EAkDAC,MAlDA,kBAkDAC,IAlDA,EAkDA;IACA;MACA;MACA;IACA,CAHA,MAGA;MACA;QACAC,eADA;;MAGAC;QACAC;MACA,CAFA,EAEA,IAFA;MAGA;IACA;IACA;IACA;;IAEA;MACA;IACA;;IAEA;MACA;IACA,CAFA,MAEA;MACA;IACA;IACA;MACA;IACA,CAFA,MAEA;MACA;IACA;;IAEA;MACA;IACA,CAFA,MAEA;MACA;MACA;IACA;IACA;IACA;IACA;EACA,CA1FA;EA2FAC,OA3FA,qBA2FA;IACA;IACAD;MACA;MACA;QACA;MACA;IACA,CALA;EAMA,CAnGA;EAoGAE;IACA;IACAC,aAFA,2BAEA;MACAH;MACAI,MADA,CACA,SADA;MAEAC,OAFA,CAEA,iBAFA;MAGAC,IAHA;IAIA,CAPA;IAQA;IACAC,aATA,2BASA;MACAP;MACAI,MADA,CACA,SADA;MAEAC,OAFA,CAEA;QACA;QACA;UACAG;YACA;UACA,CAHA;;MAKA,CATA;MAUAF,IAVA;IAWA,CArBA;IAsBA;IACAG,YAvBA,0BAuBA;MACA;QACA;QACA;MACA;;MAEA;MACA;;MAEA;QACA;MACA,CAFA;IAGA,CAnCA;IAoCA;IACAC,WArCA,yBAqCA;MACA;QACA;QACA;QACAV;UACAF,oBADA;;MAGA,CANA,MAMA;QACA;UACAa,qBADA;UAEAlD;YACAmD,oBADA,EAFA;;UAKAJ;YACA;cACA;cACA;cACA;cACAR;gBACAF,sBADA;;YAGA;UACA,CAdA;;MAgBA;IACA,CA9DA;IA+DA;IACAe,WAhEA,yBAgEA;MACA;QACAF,uBADA;QAEAH;UACA;YACA;UACA;QACA,CANA;;IAQA,CAzEA;IA0EA;IACAM,WA3EA,yBA2EA;MACA;MACA;QACA;UACAC;QACA;QACA;MACA;MACA;MACA;MACAC;MACA;MACA;QACAL,iCADA;QAEAlD;UACAwD,6BADA;UAEA5C,eAFA;UAGA6C,QAHA;UAIAN,oBAJA,EAFA;;QAQAJ,OARA,mBAQAW,GARA,EAQA;UACAJ;UACAC;UACA;YACAA;YACA;YACA;YACA;cACAI;YACA;;YAEA;YACA;YACA;cACA;gBACAC,WADA;gBAEAC,YAFA;gBAGAC,uBAHA;gBAIAC,kBAJA;;cAMAC;cACAL;YACA;;YAEA;YACA;YACAJ;YACA;cACA;gBACA;gBACA;kBACAU;kBACAA;kBACAA;kBACAA;kBACAA;kBACAV;kBACA;oBACAU;kBACA,CAFA,MAEA;oBACAA;kBACA;gBACA,CAZA,MAYA;kBACAA;kBACAA;kBACA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA;;kBAEAA;kBACAA;kBACAA;kBACA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA;;gBAEA,CAlBA,MAkBA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA;gBACA,CAZA,MAYA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA;gBACA;gBACAD;gBACAL;cACA;YACA;YACA;cACA;cACAM;cACA;gBACAA;cACA,CAFA,MAEA;gBACAA;cACA;cACAD;cACAL;YACA;YACAL;YACAC;YACAA;YACA;cACAD;cACAA;gBACA;kBACAA;gBACA,CAFA,MAEA;kBACA;kBACAA;gBACA;cACA,CAPA;YAQA;UACA,CA/GA,MA+GA;YACA;cACAjB,kBADA;;UAGA;QACA,CA/HA;;IAiIA,CAxNA;IAyNA;IACA6B,eA1NA,2BA0NAN,EA1NA,EA0NA;MACA;QACA;QACAO,mBADA;QAEAC,EAFA,CAEA,IAFA;QAGAzB,MAHA,CAGAiB,EAHA;QAIAS;UACA9B;YACAtB,uBADA,EACA;YACAqD,WAFA;;QAIA,CALA,EAKAzB,IALA;MAMA,CAXA,MAWA;QACA;QACA0B;QACA5B,MADA,CACA,mBADA;QAEA6B,kBAFA,CAEA;UACAjC;YACAtB,2BADA,EACA;YACAqD,WAFA;;QAIA,CAPA;QAQAzB,IARA;MASA;IACA,CAlPA;IAmPA;IACA4B,QApPA,oBAoPAC,CApPA,EAoPAC,KApPA,EAoPA;MACA;MACA;IACA,CAvPA;IAwPA;IACAC,SAzPA,qBAyPAF,CAzPA,EAyPAC,KAzPA,EAyPA;MACA;MACA;IACA,CA5PA;IA6PA;IACAE,OA9PA,mBA8PA7E,IA9PA,EA8PA;MACA;MACA;MACA;MACA;QACA;QACA;UACA8E;UACAA;QACA;QACA;UACA5B,6BADA;UAEAlD;YACAM,oBADA;YAEAkD,6BAFA;YAGAuB,eAHA;YAIA5B,oBAJA;YAKA6B,kCALA,EAFA;;UASAjC,OATA,mBASAW,GATA,EASA;YACAJ;YACAA;UACA,CAZA;UAaA2B,QAbA,sBAaA;YACA3B;YACA;UACA,CAhBA;;MAkBA,CAxBA,MAwBA;QACA;UACAJ,6BADA;UAEAlD;YACAO,sBADA;YAEAiD,6BAFA;YAGAL,oBAHA;YAIA4B,eAJA,EAFA;;UAQAhC,OARA,mBAQAW,GARA,EAQA;YACAJ;YACAA;UACA,CAXA;;UAaA2B,QAbA,sBAaA;YACA3B;YACA;UACA,CAhBA;;MAkBA,CAnBA,MAmBA;QACAA;QACA;UACAJ,6BADA;UAEAlD;YACAkF,mCADA;YAEA1B,6BAFA;YAGAL,oBAHA;YAIA4B,eAJA,EAFA;;UAQAhC,OARA,mBAQAW,GARA,EAQA;YACAH;UACA,CAVA;UAWA4B,KAXA,mBAWA;YACA7B;YACAf;YACAI,MADA,CACA,SADA;YAEAC,OAFA,CAEA;cACA;cACA;YACA,CALA;YAMAC,IANA;UAOA,CApBA;UAqBAoC,QArBA,sBAqBA;YACA3B;YACA;UACA,CAxBA;;MA0BA,CA5BA,MA4BA;QACA;QACAC;QACA;QACA;QACA;QACA;QACA;UACA;YACAlB,iBADA;;UAGAE;UACAI,MADA,CACA,SADA;UAEAC,OAFA,CAEA;YACAU;YACAA;UACA,CALA;UAMAT,IANA;UAOAS;UACA;QACA;QACAA;QACA;UACAJ,6BADA;UAEAlD;YACAkF,8BADA;YAEA1B,6BAFA;YAGAL,oBAHA;YAIA4B,eAJA,EAFA;;UAQAhC,OARA,mBAQAW,GARA,EAQA;YACA;YACAH;YACAD;YACAf;YACAI,MADA,CACA,SADA;YAEAC,OAFA,CAEA;cACA;cACA;YACA,CALA;YAMAC,IANA;UAOA,CAnBA;UAoBAsC,KApBA,mBAoBA;YACA7B;YACAf;YACAI,MADA,CACA,SADA;YAEAC,OAFA,CAEA;cACA;cACA;YACA,CALA;YAMAC,IANA;UAOA,CA7BA;UA8BAoC,QA9BA,sBA8BA;YACA3B;YACA;UACA,CAjCA;;MAmCA;IACA,CAnYA;IAoYA;IACA8B,QArYA,oBAqYAC,OArYA,EAqYAvB,WArYA,EAqYA;gBACA;kBACA9D,IADA,GACA;oBACA6D,YADA;oBAEAC,wBAFA;oBAGAwB,gBAHA,EADA;;kBAMA;oBACAtF;kBACA,CAFA,MAEA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA,CAFA,MAEA;oBACAA;kBACA;kBACA;kBACA;kBACA;oBACA;kBACA,CAFA;gBAGA,CArBA;IAsBA,CA3ZA;IA4ZA;IACAuF,YA7ZA,wBA6ZAC,IA7ZA,EA6ZA;MACA;QACA;QACAlD;UACA;QACA,CAFA,EAEA,GAFA;MAGA,CALA,MAKA;QACA;QACA;MACA;IACA,CAvaA;IAwaAmD,YAxaA,wBAwaAf,CAxaA,EAwaA;MACA;QACA;MACA;IACA,CA5aA;IA6aA;IACAgB,UA9aA,sBA8aAhB,CA9aA,EA8aA;MACA;QACA;MACA;;MAEA;MACA;QACA;MACA,CAFA;IAGA,CAvbA;IAwbAiB,cAxbA,4BAwbA;MACA;MACA;MACA;MACA;IACA,CA7bA;IA8bA;IACAC,SA/bA,uBA+bA;MACArC;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;QACA;MACA,CAFA;IAGA,CA5cA;IA6cA;IACAsC,QA9cA,oBA8cAC,KA9cA,EA8cAnB,KA9cA,EA8cA;MACApC;MACAI,MADA,CACA,SADA;MAEAC,OAFA,CAEA;QACA;QACA;UACAG;YACA;cACAW;YACA;YACA;YACA;YACA;YACA;cACAqC,WADA;;YAGA;YACA;UACA,CAbA;;MAeA,CAnBA;MAoBAlD,IApBA;MAqBA;IACA,CAreA;IAseA;IACAmD,MAveA,oBAueA;MACA;MACA,CADA,EACA;QACAC,eADA,EADA;;MAIA;QACA;QACA;QACA;MACA,CARA;MASA,4BATA;;IAWA,CAnfA,EApGA;;EAylBAC,aAzlBA,2BAylBA;IACAC;IACA;IACA;MACAjD,6BADA;MAEAlD;QACAwD,6BADA;QAEAL,oBAFA,EAFA;;MAMAJ,OANA,mBAMAW,GANA,EAMA;QACAnB;MACA,CARA;;EAUA,CAtmBA,E;;;;;;;;;;;;;AClDA;AAAA;AAAA;AAAA;AAAknD,CAAgB,u9CAAG,EAAC,C;;;;;;;;;;;ACAtoD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"otherpages/chat/room/room.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './otherpages/chat/room/room.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./room.vue?vue&type=template&id=7ba9b596&\"\nvar renderjs\nimport script from \"./room.vue?vue&type=script&lang=js&\"\nexport * from \"./room.vue?vue&type=script&lang=js&\"\nimport style0 from \"./room.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"otherpages/chat/room/room.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=template&id=7ba9b596&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.emjoyShow\n    ? _vm.__map(_vm.emjoyList, function (item, index) {\n        var $orig = _vm.__get_orig(item)\n\n        var g0 = _vm.$util.img(item)\n        return {\n          $orig: $orig,\n          g0: g0,\n        }\n      })\n    : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\" id=\"container\" :data-theme=\"themeStyle\">\r\n\t\t<view class=\"room\" @click=\"closePopWindow\">\r\n\t\t\t<view class=\"tips\" :class=\"{ show: isLoading }\">正在获取消息</view>\r\n\t\t\t<view class=\"room-content-box\">\r\n\t\t\t\t<view :id=\"'chat' + index\" v-for=\"(item, index) in messageList\" :key=\"index\">\r\n\t\t\t\t\t<chat-message :message=\"item\" :shopInfo=\"shopInfo\" :userInfo=\"userInfo\" @sendGood=\"sendGood($event, index)\"\r\n\t\t\t\t\t @sendOrder=\"sendOrder($event, index)\" :send=\"send\"></chat-message>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"paddingbottom\" id=\"paddingbottom\" v-if=\"chatBottom\"></view>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"input-content\">\r\n\t\t\t<view class=\"input-box\">\r\n\t\t\t\t<view class=\"iconfont iconbiaoqing1 padding-right \" @click=\"openEmjoy()\"></view>\r\n\t\t\t\t<editor id=\"editor\" class=\"message-edit\" v-model=\"formData.content\" @ready=\"onEditorReady\" @focus=\"inputFocus\"\r\n\t\t\t\t @input=\"onEditorinput()\" @blur=\"closePopWindow()\"></editor>\r\n\t\t\t\t<!-- <input type=\"text\" class=\"message\" placeholder=\"点此提问客服\" id=\"input\" v-model=\"formData.content\" placeholder-style=\"color:#DDDDDD;\"\r\n\t\t\t\t cursor-spacing=\"10\" @confirm=\"sendMsg('message')\" @focus=\"inputFocus\" @blur=\"closePopWindow()\" confirm-type=\"send\"\r\n\t\t\t\t @keyboardHeightChange=\"onKeyboardHeightChange\" /> -->\r\n\t\t\t\t<view class=\"iconfont iconjiahao01 padding-right\" @click=\"openChatMore()\"></view>\r\n\t\t\t\t<view class=\"iconfont send_btn color-base-bg\" @click=\"sendMsg('message')\">发送</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"inputShow\" v-if=\"inputShow && inputFirst\"></view>\r\n\t\t\t<view v-if=\"emjoyShow\" @touchmove.prevent.stop>\r\n\t\t\t\t<view class=\"emjoy-box\">\r\n\t\t\t\t\t<scroll-view scroll-y=\"true\" class=\"emjoy-content\">\r\n\t\t\t\t\t\t<view class=\"emjoy-item\" v-for=\"(item, index) in emjoyList\" :key=\"index\" @click=\"addEmjoy(item, index)\">\r\n\t\t\t\t\t\t\t<image :src=\"$util.img(item)\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</scroll-view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"more_send\" v-if=\"chatMore\">\r\n\t\t\t\t<view class=\"more_send-item\" @click=\"addImg()\">\r\n\t\t\t\t\t<i class=\"iconfont icontupian \"></i>\r\n\t\t\t\t\t<view>图片</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport SocketTask from '@/common/js/socketTest.js';\r\n\timport chatMessage from '@/otherpages/components/chat-message/chat-message.vue';\r\n\timport emjoy from '@/common/js/emjoy.js';\r\n\timport globalConfig from '@/common/js/golbalConfig.js';\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tchatMessage\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\temjoyList: emjoy.emjoyList,\r\n\t\t\t\temjoyShow: false,\r\n\t\t\t\tchatMore: false,\r\n\t\t\t\tformData: {\r\n\t\t\t\t\tcontent: '',\r\n\t\t\t\t\tgoods_id: 0,\r\n\t\t\t\t\torder_id: 0,\r\n\t\t\t\t\timage: ''\r\n\t\t\t\t},\r\n\t\t\t\tisNetWork: false,\r\n\t\t\t\tsend: false,\r\n\r\n\t\t\t\tmessageList: [],\r\n\t\t\t\tpage: 1,\r\n\t\t\t\tisAll: false,\r\n\t\t\t\tisLoading: 0,\r\n\t\t\t\tshowLoading: false, //显示正在加载\r\n\r\n\t\t\t\tjumpBottom: null,\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tscrollPosition: 0,\r\n\r\n\t\t\t\tsiteId: 0, //店铺id\r\n\t\t\t\tskuId: 0, //商品id\r\n\t\t\t\torderId: 0, //订单id\r\n\t\t\t\tsiteName: '', //店铺名称\r\n\t\t\t\tshopInfo: {},\r\n\t\t\t\tuserInfo: {},\r\n\t\t\t\tstyle: {}, //聊天框的高度\r\n\t\t\t\tinputFirst: 0,\r\n\t\t\t\tinputShow: false,\r\n\t\t\t\tinputOffsetBottom: 0,\r\n\t\t\t\tgoods_type: {\r\n\t\t\t\t\tpromotion_name: '',\r\n\t\t\t\t\tpromotion_id: ''\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tmixins: [SocketTask, globalConfig],\r\n\t\tcomputed: {\r\n\t\t\tchatBottom() {\r\n\t\t\t\treturn this.emjoyShow || this.chatMore || this.inputShow;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(info) {\r\n\t\t\tif (info.site_id) {\r\n\t\t\t\tthis.siteId = info.site_id;\r\n\t\t\t\tthis.getShopInfo();\r\n\t\t\t} else {\r\n\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\ttitle: '缺少必要参数'\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.skuId = info.sku_id ? info.sku_id : 0;\r\n\t\t\tthis.orderId = info.order_id ? info.order_id : 0;\r\n\r\n\t\t\tif (this.skuId || this.orderId) {\r\n\t\t\t\tthis.send = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (info.type) {\r\n\t\t\t\tthis.goods_type.promotion_name = info.type;\r\n\t\t\t} else {\r\n\t\t\t\tthis.goods_type.promotion_name = '';\r\n\t\t\t}\r\n\t\t\tif (info.type_id) {\r\n\t\t\t\tthis.goods_type.promotion_id = info.type_id;\r\n\t\t\t} else {\r\n\t\t\t\tthis.goods_type.promotion_id = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (uni.getStorageSync('token')) {\r\n\t\t\t\tthis.getUserInfo();\r\n\t\t\t} else {\r\n\t\t\t\tthis.$util.redirectTo('/pages/login/login/login');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.inputFirst = 0;\r\n\t\t\tthis.inputShow = false;\r\n\t\t\tthis.inputOffsetBottom = 0;\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\t// 监听键盘高度变化，以便设置输入框的高度\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tthis.inputOffsetBottom = res.height;\r\n\t\t\t\tif (res.height === 0) {\r\n\t\t\t\t\tthis.focus = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 初次渲染输入框\r\n\t\t\tonEditorReady() {\r\n\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t.context(res => {})\r\n\t\t\t\t\t.exec();\r\n\t\t\t},\r\n\t\t\t// 输入时，边输入边保存\r\n\t\t\tonEditorinput() {\r\n\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\tthis.editorCtx = res.context;\r\n\t\t\t\t\t\tthis.editorCtx.getContents({\r\n\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\tthis.formData.content = res.html;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec();\r\n\t\t\t},\r\n\t\t\t// 加号\r\n\t\t\topenChatMore() {\r\n\t\t\t\tif (this.$util.isAndroid) {\r\n\t\t\t\t\tthis.inputShow = false;\r\n\t\t\t\t\tthis.inputFirst = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.chatMore = !this.chatMore;\r\n\t\t\t\tthis.emjoyShow = false;\r\n\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.setPageScrollTo();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//获取店铺详情，修改头部\r\n\t\t\tgetShopInfo() {\r\n\t\t\t\tif (this.siteId == 0) {\r\n\t\t\t\t\tthis.siteName = '平台客服';\r\n\t\t\t\t\t//修改标题\r\n\t\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\t\ttitle: this.siteName\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\turl: '/api/shop/info',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tsite_id: this.siteId\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\t\t\tthis.shopInfo = res.data;\r\n\t\t\t\t\t\t\t\tthis.siteName = res.data.site_name;\r\n\t\t\t\t\t\t\t\t//修改标题\r\n\t\t\t\t\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\t\t\t\t\ttitle: this.siteName\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//获取个人信息\r\n\t\t\tgetUserInfo() {\r\n\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\turl: '/api/member/info',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\t\tthis.userInfo = res.data;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//获取聊天记录\r\n\t\t\tgetChatList() {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tif (this.isAll) {\r\n\t\t\t\t\tif (that.mescroll) {\r\n\t\t\t\t\t\tthat.mescroll.endSuccess();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.isLoading) return;\r\n\t\t\t\tthis.isLoading = true;\r\n\t\t\t\tconsole.log(this.page, 'this.page')\r\n\t\t\t\tif (this.page == 1) this.messageList = [];\r\n\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\turl: '/servicer/api/chat/dialogs',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\t\tlimit: 7,\r\n\t\t\t\t\t\tsite_id: that.siteId\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tthat.page += 1;\r\n\t\t\t\t\t\tconsole.log(that.page, 'this.page')\r\n\t\t\t\t\t\tif (res.code >= 0 && res.data) {\r\n\t\t\t\t\t\t\tconsole.log(res.data.list.length, 'res.data.list')\r\n\t\t\t\t\t\t\tif (res.data.list && res.data.list.length < 5) that.isAll = true;\r\n\t\t\t\t\t\t\tlet startId = 0;\r\n\t\t\t\t\t\t\tif (this.messageList) {\r\n\t\t\t\t\t\t\t\tstartId = this.messageList.slice(-1).id + 1;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet newArr = [];\r\n\t\t\t\t\t\t\t//如果请求的是第一页，并且有订单id或商品id;添加发送信息\r\n\t\t\t\t\t\t\tif (that.skuId) {\r\n\t\t\t\t\t\t\t\tlet obj = {\r\n\t\t\t\t\t\t\t\t\tid: startId,\r\n\t\t\t\t\t\t\t\t\tisItMe: true,\r\n\t\t\t\t\t\t\t\t\tcontentType: 'sendGood',\r\n\t\t\t\t\t\t\t\t\tsku_id: that.skuId\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tnewArr.push(obj);\r\n\t\t\t\t\t\t\t\tstartId += 1;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t//如果获取到历史聊天信息  转换为需要的格式  添加到数组内\r\n\t\t\t\t\t\t\tlet arr = res.data.list;\r\n\t\t\t\t\t\t\tconsole.log(arr, 'arr')\r\n\t\t\t\t\t\t\tif (arr.length) {\r\n\t\t\t\t\t\t\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\t\t\t\t\t\t\tlet obj = {};\r\n\t\t\t\t\t\t\t\t\tif (arr[i].content_type == 0) {\r\n\t\t\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\t\t\tobj.content = arr[i].type == 0 ? arr[i].consumer_say : arr[i].servicer_say;\r\n\t\t\t\t\t\t\t\t\t\tobj.isItMe = arr[i].type == 0 ? true : false;\r\n\t\t\t\t\t\t\t\t\t\tobj.contentType = 'string';\r\n\t\t\t\t\t\t\t\t\t\tobj.sendStatus = true;\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(arr[i], 'arr[i]')\r\n\t\t\t\t\t\t\t\t\t\tif (arr[i].avatar) {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].avatar\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].logo\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if (arr[i].content_type == 1) {\r\n\t\t\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\t\t\tobj.isItMe = arr[i].type == 0 ? true : false;\r\n\t\t\t\t\t\t\t\t\t\tif (arr[i].type != 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.contentType = 'goods';\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.contentType = 'goodssku';\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tobj.sku_id = arr[i].goods_sku_id;\r\n\t\t\t\t\t\t\t\t\t\tobj.send = false;\r\n\t\t\t\t\t\t\t\t\t\tobj.sendStatus = true;\r\n\t\t\t\t\t\t\t\t\t\tif (arr[i].avatar) {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].avatar\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].logo\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t} else if (arr[i].content_type == 2) {\r\n\t\t\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\t\t\tobj.isItMe = arr[i].type == 0 ? true : false;\r\n\t\t\t\t\t\t\t\t\t\tobj.contentType = 'order';\r\n\t\t\t\t\t\t\t\t\t\tobj.order_id = arr[i].order_id;\r\n\t\t\t\t\t\t\t\t\t\tobj.send = false;\r\n\t\t\t\t\t\t\t\t\t\tobj.sendStatus = true;\r\n\t\t\t\t\t\t\t\t\t\tif (arr[i].avatar) {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].avatar\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].logo\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if (arr[i].content_type == 3) {\r\n\t\t\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\t\t\tobj.isItMe = arr[i].type == 0 ? true : false;\r\n\t\t\t\t\t\t\t\t\t\tobj.contentType = 'image';\r\n\t\t\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\t\t\tobj.image = arr[i].type == 0 ? arr[i].consumer_say : arr[i].servicer_say;\r\n\t\t\t\t\t\t\t\t\t\tobj.sendStatus = true;\r\n\t\t\t\t\t\t\t\t\t\tif (arr[i].avatar) {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].avatar\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tobj.avatar = arr[i].logo\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnewArr.push(obj);\r\n\t\t\t\t\t\t\t\t\tstartId += 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (that.page == 2) {\r\n\t\t\t\t\t\t\t\tlet obj = {};\r\n\t\t\t\t\t\t\t\tobj.id = startId;\r\n\t\t\t\t\t\t\t\tif (that.servicer_id > 0) {\r\n\t\t\t\t\t\t\t\t\tobj.contentType = 'online';\r\n\t\t\t\t\t\t\t\t} else if (that.servicer_id == 0) {\r\n\t\t\t\t\t\t\t\t\tobj.contentType = 'noline';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tnewArr.push(obj);\r\n\t\t\t\t\t\t\t\tstartId += 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthat.isLoading = false;\r\n\t\t\t\t\t\t\tconsole.log(that.messageList, 'that.messageList')\r\n\t\t\t\t\t\t\tconsole.log(newArr, 'newArr')\r\n\t\t\t\t\t\t\tif (newArr.length) {\r\n\t\t\t\t\t\t\t\tthat.messageList = newArr.concat(that.messageList);\r\n\t\t\t\t\t\t\t\tthat.$nextTick(() => {\r\n\t\t\t\t\t\t\t\t\tif (that.page == 2) {\r\n\t\t\t\t\t\t\t\t\t\tthat.setPageScrollTo();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tlet id = '#chat' + newArr.length;\r\n\t\t\t\t\t\t\t\t\t\tthat.setPageScrollTo(id);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\t\t\t\ttitle: res.message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 设置页面滚动位置\r\n\t\t\tsetPageScrollTo(id) {\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\tlet view = uni\r\n\t\t\t\t\t\t.createSelectorQuery()\r\n\t\t\t\t\t\t.in(this)\r\n\t\t\t\t\t\t.select(id);\r\n\t\t\t\t\tview.boundingClientRect(res => {\r\n\t\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\t\tscrollTop: res.top - 30, // -30 为多显示出大半个消息的高度，示意上面还有信息。\r\n\t\t\t\t\t\t\tduration: 0\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).exec();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet query = uni.createSelectorQuery().in(this);\r\n\t\t\t\t\tquery\r\n\t\t\t\t\t\t.select('.room-content-box')\r\n\t\t\t\t\t\t.boundingClientRect(data => {\r\n\t\t\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\t\t\tscrollTop: data.height - 30, // -30 为多显示出大半个消息的高度，示意上面还有信息。\r\n\t\t\t\t\t\t\t\tduration: 0\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.exec();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//发送商品\r\n\t\t\tsendGood(e, index) {\r\n\t\t\t\tthis.sendMsg('goods');\r\n\t\t\t\tthis.messageList.splice(index, 1);\r\n\t\t\t},\r\n\t\t\t//发送订单\r\n\t\t\tsendOrder(e, index) {\r\n\t\t\t\tthis.sendMsg('order');\r\n\t\t\t\tthis.messageList.splice(index, 1);\r\n\t\t\t},\r\n\t\t\t//发送消息\r\n\t\t\tsendMsg(data) {\r\n\t\t\t\tif (this.isNetWork) return;\r\n\t\t\t\tthis.isNetWork = true;\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tif (data == 'goods') {\r\n\t\t\t\t\tlet _type = {};\r\n\t\t\t\t\tif (this.goods_type.promotion_id != '') {\r\n\t\t\t\t\t\t_type.promotion_id = this.goods_type.promotion_id;\r\n\t\t\t\t\t\t_type.promotion_name = this.goods_type.promotion_name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\turl: '/servicer/api/chat/say',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tgoods_id: this.skuId,\r\n\t\t\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\t\t\tcontent_type: 1,\r\n\t\t\t\t\t\t\tsite_id: this.siteId,\r\n\t\t\t\t\t\t\trelate_data: JSON.stringify(_type)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tthat.send = false;\r\n\t\t\t\t\t\t\tthat.joinData('send', 'goods');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\tthat.isNetWork = false;\r\n\t\t\t\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (data == 'order') {\r\n\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\turl: '/servicer/api/chat/say',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\torder_id: this.orderId,\r\n\t\t\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\t\t\tsite_id: this.siteId,\r\n\t\t\t\t\t\t\tcontent_type: 2\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tthat.send = false;\r\n\t\t\t\t\t\t\tthat.joinData('send', 'order');\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\tthat.isNetWork = false;\r\n\t\t\t\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (data == 'image') {\r\n\t\t\t\t\tthat.joinData('send', 'image');\r\n\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\turl: '/servicer/api/chat/say',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tmessage: this.formData.image.trim(),\r\n\t\t\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\t\t\tsite_id: this.siteId,\r\n\t\t\t\t\t\t\tcontent_type: 3\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tconsole.log(res, '图片上传成功');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror() {\r\n\t\t\t\t\t\t\tthat.messageList[that.messageList.length - 1].sendStatus = false;\r\n\t\t\t\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx = res.context;\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx.clear();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.exec();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\tthat.isNetWork = false;\r\n\t\t\t\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// this.closePopWindow()\r\n\t\t\t\t\tconsole.log(this.formData.content, 'this.formData.content');\r\n\t\t\t\t\tlet _text = this.formData.content;\r\n\t\t\t\t\tlet _testText = _text.replace(/<p>/, '');\r\n\t\t\t\t\tlet _testText2 = _testText.replace(/<\\/p>/, '');\r\n\t\t\t\t\tlet _testText3 = _testText2.replace(/<br>/, '');\r\n\t\t\t\t\tif (_text == '<p></p>' || _text == '<p><br></p>' || !_testText3.trim()) {\r\n\t\t\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\t\t\ttitle: '发送内容不能为空'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\t\t\tthat.editorCtx = res.context;\r\n\t\t\t\t\t\t\t\tthat.editorCtx.clear();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.exec();\r\n\t\t\t\t\t\tthat.isNetWork = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.joinData('send', 'string');\r\n\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\turl: '/servicer/api/chat/say',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tmessage: this.formData.content,\r\n\t\t\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\t\t\tsite_id: this.siteId,\r\n\t\t\t\t\t\t\tcontent_type: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t// that.joinData('send', 'string');\r\n\t\t\t\t\t\t\tconsole.log(res, '文字上传成功');\r\n\t\t\t\t\t\t\tthat.formData.content = '<p></p>';\r\n\t\t\t\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx = res.context;\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx.clear();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.exec();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror() {\r\n\t\t\t\t\t\t\tthat.messageList[that.messageList.length - 1].sendStatus = false;\r\n\t\t\t\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx = res.context;\r\n\t\t\t\t\t\t\t\t\tthis.editorCtx.clear();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.exec();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\tthat.isNetWork = false;\r\n\t\t\t\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//拼接消息 处理滚动\r\n\t\t\tasync joinData(addType, contentType) {\r\n\t\t\t\tif (addType == 'send') {\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\tisItMe: true,\r\n\t\t\t\t\t\tcontentType: contentType,\r\n\t\t\t\t\t\tsendStatus: true\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (contentType == 'string') {\r\n\t\t\t\t\t\tdata.content = this.formData.content;\r\n\t\t\t\t\t} else if (contentType == 'order') {\r\n\t\t\t\t\t\tdata.order_id = this.orderId;\r\n\t\t\t\t\t} else if (contentType == 'goods') {\r\n\t\t\t\t\t\tdata.sku_id = this.skuId;\r\n\t\t\t\t\t} else if (contentType == 'image') {\r\n\t\t\t\t\t\tdata.image = this.formData.image;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.messageList.push(data);\r\n\t\t\t\t\t// this.formData.content = '';\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.setPageScrollTo();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 隐藏加载提示\r\n\t\t\thideLoadTips(flag) {\r\n\t\t\t\tif (flag) {\r\n\t\t\t\t\tthis.ajax.loadText = '消息获取成功';\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.ajax.loading = false;\r\n\t\t\t\t\t}, 300);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.ajax.loading = true;\r\n\t\t\t\t\tthis.ajax.loadText = '正在获取消息';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonPageScroll(e) {\r\n\t\t\t\tif (e.scrollTop < 5 && e.scrollTop >= 0) {\r\n\t\t\t\t\tthis.getChatList();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//\r\n\t\t\tinputFocus(e) {\r\n\t\t\t\tif (this.$util.isAndroid() && this.inputFirst) {\r\n\t\t\t\t\tthis.inputShow = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.chatMore = false;\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.setPageScrollTo();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tclosePopWindow() {\r\n\t\t\t\tthis.inputFirst = 0;\r\n\t\t\t\tthis.chatMore = false;\r\n\t\t\t\tthis.inputShow = false;\r\n\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t},\r\n\t\t\t// 展开表情\r\n\t\t\topenEmjoy() {\r\n\t\t\t\tconsole.log(this.emjoyShow, 'this.emjoyShow');\r\n\t\t\t\t// if (this.$util.isAndroid()) {\r\n\t\t\t\t// \tthis.inputFirst = 1;\r\n\t\t\t\t// \tthis.inputShow = !this.inputShow;\r\n\t\t\t\t// }\r\n\r\n\t\t\t\t// uni.hideKeyboard();\r\n\t\t\t\tthis.chatMore = false;\r\n\t\t\t\tthis.emjoyShow = !this.emjoyShow;\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.setPageScrollTo();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 添加表情\r\n\t\t\taddEmjoy(emjoy, index) {\r\n\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t.select('#editor')\r\n\t\t\t\t\t.context(res => {\r\n\t\t\t\t\t\tthis.editorCtx = res.context;\r\n\t\t\t\t\t\tthis.editorCtx.getContents({\r\n\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\tif (res.html == '<p><br></p>') {\r\n\t\t\t\t\t\t\t\t\tres.html = '<p></p>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tlet _src = this.$util.img(emjoy);\r\n\t\t\t\t\t\t\t\tlet text = '<img src=' + _src + ' style=\"height=\"20px; width=20px; margin-left=20px;\">';\r\n\t\t\t\t\t\t\t\tlet html2 = res.html.replace(/<\\/p>$/, text + '</p>');\r\n\t\t\t\t\t\t\t\tthis.editorCtx.setContents({\r\n\t\t\t\t\t\t\t\t\thtml: html2\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tthis.formData.content = html2;\r\n\t\t\t\t\t\t\t\tthis.emjoyShow = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec();\r\n\t\t\t\t// this.formData.content = this.formData.content + index;\r\n\t\t\t},\r\n\t\t\t// 发送图片\r\n\t\t\taddImg() {\r\n\t\t\t\tthis.$util.upload(\r\n\t\t\t\t\t1, {\r\n\t\t\t\t\t\tpath: 'chatimg'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tres => {\r\n\t\t\t\t\t\tthis.formData.image = res[0];\r\n\t\t\t\t\t\t// this.chatMore = false;\r\n\t\t\t\t\t\tthis.sendMsg('image');\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'/servicer/api/chat/chatimg'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\tclearInterval(this.timeoutObj);\r\n\t\t\tthis.timeoutObj = null;\r\n\t\t\tthis.$api.sendRequest({\r\n\t\t\t\turl: '/servicer/api/chat/bye',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tservicer_id: this.servicer_id,\r\n\t\t\t\t\tsite_id: this.siteId\r\n\t\t\t\t},\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tuni.closeSocket();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t//处理H5端弹出覆盖输入框的问题\r\n\t.more_send {\r\n\t\tdisplay: flex;\r\n\t\tborder-top: 2rpx solid #e5e5e5;\r\n\t\theight: 390rpx;\r\n\t\tflex-wrap: wrap;\r\n\r\n\t\t>view {\r\n\t\t\tpadding-top: 16rpx;\r\n\t\t\twidth: 25%;\r\n\t\t\theight: 156rpx;\r\n\t\t\ttext-align: center;\r\n\r\n\t\t\t.iconfont {\r\n\t\t\t\tdisplay: inline;\r\n\t\t\t\tfont-size: 60rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tborder-radius: 20rpx;\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t>view {\r\n\t\t\t\tcolor: #909399;\r\n\t\t\t\tfont-size: $font-size-goods-tag;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.chat_send {\r\n\t\tdisplay: flex;\r\n\t\theight: 45px;\r\n\t\tjustify-content: space-between;\r\n\t\tposition: relative;\r\n\r\n\t\t.send {\r\n\t\t\tposition: absolute;\r\n\t\t\tright: 30rpx;\r\n\t\t\tbottom: 30rpx;\r\n\t\t\tcolor: #fff;\r\n\t\t\talign-self: flex-end;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tpadding: 10rpx 20rpx;\r\n\t\t\tborder-radius: 8rpx;\r\n\t\t}\r\n\r\n\t\t.emjoy_list {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/* 加载数据提示 */\r\n\t.tips {\r\n\t\tposition: fixed;\r\n\t\tleft: 0;\r\n\t\ttop: var(--window-top);\r\n\t\twidth: 100%;\r\n\t\tz-index: 9;\r\n\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\theight: 72rpx;\r\n\t\tline-height: 72rpx;\r\n\t\ttransform: translateY(-80rpx);\r\n\t\ttransition: transform 0.3s ease-in-out 0s;\r\n\t\tfont-size: 24rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 72rpx;\r\n\r\n\t\t&.show {\r\n\t\t\ttransform: translateY(0);\r\n\t\t}\r\n\t}\r\n\r\n\t.room {\r\n\t\twidth: 100%;\r\n\t\t/* #ifdef H5 */\r\n\t\tmin-height: calc(100vh - 24px);\r\n\t\tpadding-bottom: calc(110rpx + 44px);\r\n\t\tpadding-bottom: calc(110rpx + 44px + constant(safe-area-inset-bottom));\r\n\t\tpadding-bottom: calc(110rpx + 44px + env(safe-area-inset-bottom));\r\n\t\t/* #endif */\r\n\r\n\t\t/* #ifndef H5 */\r\n\t\tmin-height: calc(100vh + 10px);\r\n\t\tpadding-bottom: 110rpx;\r\n\t\tpadding-bottom: calc(110rpx + constant(safe-area-inset-bottom));\r\n\t\tpadding-bottom: calc(110rpx + env(safe-area-inset-bottom));\r\n\t\t/* #endif */\r\n\r\n\t\tbox-sizing: border-box;\r\n\r\n\t\t.room-content-box {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: calc(100% + 10px);\r\n\t\t\tpadding-top: $padding;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t}\r\n\t}\r\n\r\n\t.paddingbottom {\r\n\t\theight: calc(470rpx + 44px);\r\n\t}\r\n\r\n\t.emjoy-box {\r\n\t\twidth: 100%;\r\n\t\theight: 300rpx;\r\n\t\tpadding: 20rpx 25rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: #f4f4f4;\r\n\t\tborder-top: 1rpx solid #e5e5e5;\r\n\r\n\t\t.emjoy-content {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\r\n\t\t\t.emjoy-item {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t\twidth: 100rpx;\r\n\t\t\t\theight: 70rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tline-height: 70rpx;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\tdisplay: inline-block;\r\n\t\t\t\t\twidth: 40rpx;\r\n\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.input-content {\r\n\t\tbackground: #f4f4f4;\r\n\t\twidth: 100%;\r\n\t\tmin-height: 110rpx;\r\n\t\tposition: fixed;\r\n\t\tleft: 0;\r\n\t\tbottom: 0;\r\n\t\tpadding-bottom: 0px;\r\n\t\tpadding-bottom: constant(safe-area-inset-bottom);\r\n\t\tpadding-bottom: env(safe-area-inset-bottom);\r\n\r\n\t\t.input-box {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: auto;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: flex-end;\r\n\t\t\tpadding: 10rpx $padding;\r\n\t\t\tbox-sizing: border-box;\r\n\r\n\t\t\t.iconfont {\r\n\t\t\t\tline-height: 1;\r\n\t\t\t\tfont-size: 52rpx;\r\n\t\t\t\tpadding: 15rpx;\r\n\r\n\t\t\t\t&.send_btn {\r\n\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\tmin-width: 60rpx;\r\n\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\tbackground-color: #e8e8e8;\r\n\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\theight: 32rpx;\r\n\t\t\t\t\tline-height: 32rpx;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.message-edit {\r\n\t\t\t\tpadding: 4rpx 15rpx;\r\n\t\t\t\tline-height: 1.5;\r\n\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\t// height: 90rpx;\r\n\t\t\t\tmin-height: 60rpx !important;\r\n\t\t\t\t// max-height: 200rpx;\r\n\t\t\t\theight: auto !important;\r\n\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\tfont-size: $font-size-base;\r\n\t\t\t}\r\n\r\n\t\t\t// input {\r\n\t\t\t// \tmargin-left: 20rpx;\r\n\t\t\t// \tmargin-right: 20rpx;\r\n\t\t\t// \twidth: 630rpx;\r\n\t\t\t// \theight: 100%;\r\n\t\t\t// \theight: 72rpx;\r\n\t\t\t// \tpadding: 0 20rpx;\r\n\t\t\t// \tfont-size: $font-size-tag;\r\n\t\t\t// \tbackground-color: #fff;\r\n\t\t\t// \tborder-radius: 8rpx;\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1666844732565\n      var cssReload = require(\"/Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}