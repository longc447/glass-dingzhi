{"version":3,"sources":["webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?1479","webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?3623","webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?a5d0","webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?ff79","uni-app:///components/payment/payment.vue","webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?f22e","webpack:////Users/longchu/Documents/接单/改客服源码/components/payment/payment.vue?82fe"],"names":["name","components","uniPopup","nsSwitch","props","balanceDeduct","type","default","isBalance","payMoney","data","isIphoneX","payIndex","payTypeList","provider","icon","payInfo","created","methods","open","close","useBalance","confirm","title","uni","mask","getPayInfo","out_trade_no","url","success","setTimeout","getPayType","pay","pay_type","timeStamp","nonceStr","package","signType","paySign","fail","filters","moneyFormat","money"],"mappings":"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","file":"components/payment/payment.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./payment.vue?vue&type=template&id=2cdd4fdc&\"\nvar renderjs\nimport script from \"./payment.vue?vue&type=script&lang=js&\"\nexport * from \"./payment.vue?vue&type=script&lang=js&\"\nimport style0 from \"./payment.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/payment/payment.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./payment.vue?vue&type=template&id=2cdd4fdc&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-popup/uni-popup\" */ \"@/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    nsSwitch: function () {\n      return import(\n        /* webpackChunkName: \"components/ns-switch/ns-switch\" */ \"@/components/ns-switch/ns-switch.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var f0 = _vm._f(\"moneyFormat\")(_vm.payMoney)\n\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event, index) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        index = _temp2.index\n\n      var _temp, _temp2\n\n      _vm.payIndex = index\n    }\n  }\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        f0: f0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./payment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./payment.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<!-- 选择支付方式弹窗 -->\r\n\t\t<uni-popup ref=\"choosePaymentPopup\" type=\"center\">\r\n\t\t\t<view class=\"choose-payment-popup popup\" @touchmove.prevent.stop>\r\n\t\t\t\t<view class=\"popup-header\">\r\n\t\t\t\t\t<text class=\"tit\">支付方式</text>\r\n\t\t\t\t\t<text class=\"iconfont iconclose\" @click=\"close()\"></text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<scroll-view scroll-y=\"true\" class=\"popup-body\" :class=\"{ 'safe-area': isIphoneX }\">\r\n\t\t\t\t\t<view class=\"pay-money\">\r\n\t\t\t\t\t\t<!-- <text class=\"unit\">{{ $lang('common.currencySymbol') }}</text> -->\r\n\t\t\t\t\t\t<text class=\"money\">支付金额{{ payMoney | moneyFormat }}元</text>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view class=\"payment-item\" v-if=\"balanceDeduct > 0\">\r\n\t\t\t\t\t\t<view class=\"iconfont iconyue\"></view>\r\n\t\t\t\t\t\t<view class=\"info-wrap\">\r\n\t\t\t\t\t\t\t<text class=\"name\">余额抵扣</text>\r\n\t\t\t\t\t\t\t<view class=\"money\">可用¥{{ balanceDeduct }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<ns-switch class=\"balance-switch\" @change=\"useBalance\" :checked=\"isBalance == 1\"></ns-switch>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<block v-if=\"payMoney > 0\">\r\n\t\t\t\t\t\t<block v-if=\"payTypeList.length\">\r\n\t\t\t\t\t\t\t<view class=\"payment-item\" v-for=\"(item, index) in payTypeList\" :key=\"index\" @click=\"payIndex = index\">\r\n\t\t\t\t\t\t\t\t<view class=\"iconfont\" :class=\"item.icon\"></view>\r\n\t\t\t\t\t\t\t\t<text class=\"name\">{{ item.name }}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"iconfont\" :class=\"payIndex == index ? 'iconyuan_checked color-base-text' : 'iconcheckboxblank'\"></text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t<block v-else><view class=\"empty\">平台尚未配置支付方式！</view></block>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t\t<view class=\"popup-footer\" :class=\"{ 'bottom-safe-area': isIphoneX }\"><view class=\"confirm-btn color-base-bg\" @click=\"confirm()\">确认支付</view></view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport uniPopup from '@/components/uni-popup/uni-popup.vue';\r\nimport nsSwitch from '@/components/ns-switch/ns-switch.vue';\r\n\r\n// #ifdef H5 || APP-PLUS\r\nimport { Weixin } from 'common/js/wx-jssdk.js';\r\n// #endif\r\n\r\nexport default {\r\n\tname: 'payment',\r\n\tcomponents: {\r\n\t\tuniPopup,\r\n\t\tnsSwitch\r\n\t},\r\n\tprops: {\r\n\t\tbalanceDeduct: {\r\n\t\t\ttype: [Number, String],\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\tisBalance: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tpayMoney: {\r\n\t\t\ttype: [Number, String],\r\n\t\t\tdefault: 0\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tisIphoneX: false,\r\n\t\t\tpayIndex: 0,\r\n\t\t\t// #ifdef H5 || APP-PLUS\r\n\t\t\tpayTypeList: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '支付宝支付',\r\n\t\t\t\t\ticon: 'iconzhifubaozhifu-',\r\n\t\t\t\t\ttype: 'alipay'\r\n\t\t\t\t}\r\n\t\t\t\t,\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '微信支付',\r\n\t\t\t\t\ticon: 'iconweixin1',\r\n\t\t\t\t\ttype: 'wechatpay'\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\ttimer: null,\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\tpayTypeList: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '微信支付',\r\n\t\t\t\t\tprovider: 'wxpay',\r\n\t\t\t\t\ticon: 'iconweixin1',\r\n\t\t\t\t\ttype: 'wechatpay'\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t// #endif\r\n\t\t\tpayInfo: {}\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.isIphoneX = this.$util.uniappIsIPhoneX();\r\n\t\tthis.getPayType();\r\n\t},\r\n\tmethods: {\r\n\t\topen() {\r\n\t\t\tthis.$refs.choosePaymentPopup.open();\r\n\t\t},\r\n\t\tclose() {\r\n\t\t\tthis.$refs.choosePaymentPopup.close();\r\n\t\t},\r\n\t\t// 使用余额\r\n\t\tuseBalance() {\r\n\t\t\tthis.$emit('useBalance');\r\n\t\t},\r\n\t\tconfirm() {\r\n\t\t\tif (this.payTypeList.length == 0 && this.payMoney > 0) {\r\n\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\ttitle: '请选择支付方式！'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '支付中...',\r\n\t\t\t\tmask: true\r\n\t\t\t});\r\n\t\t\tthis.$refs.choosePaymentPopup.close();\r\n\t\t\tthis.$emit('confirm');\r\n\t\t\tuni.setStorageSync('pay_flag', 1);\r\n\t\t},\r\n\t\tgetPayInfo(out_trade_no) {\r\n\t\t\tthis.$api.sendRequest({\r\n\t\t\t\turl: '/api/pay/info',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tout_trade_no\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res.code >= 0 && res.data) {\r\n\t\t\t\t\t\tthis.payInfo = res.data;\r\n\t\t\t\t\t\tthis.pay();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\t\t\ttitle: '未获取到支付信息！'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/index/index/index', {}, 'reLaunch');\r\n\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPayType() {\r\n\t\t\tthis.$api.sendRequest({\r\n\t\t\t\turl: '/api/pay/type',\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\tthis.payTypeList.forEach((val, key) => {\r\n\t\t\t\t\t\t\tif (res.data.pay_type.indexOf(val.type) == -1) {\r\n\t\t\t\t\t\t\t\tthis.payTypeList.splice(key, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//#ifdef APP-PLUS\r\n\t\tpay() {\r\n\t\t\tvar payType = this.payTypeList[this.payIndex];\r\n\t\t\tconsole.log('微信支付开始')\r\n\t\t\tif (!payType) return;\r\n\t\t\tconsole.log(this.payInfo.out_trade_no)\r\n\t\t\tconsole.log(payType.type)\r\n\t\t\tthis.$api.sendRequest({\r\n\t\t\t\turl: '/api/pay/pay',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tout_trade_no: this.payInfo.out_trade_no,\r\n\t\t\t\t\tpay_type: payType.type,\r\n\t\t\t\t\tapp_type:'app'\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif (res.code >= 0) {\r\n\t\t\t\t\t\t//提示错误信息\r\n\t\t\t\t\t\tif (res.code != 0) {\r\n\t\t\t\t\t\t\tthis.$util.showToast({ title: res.message });\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\t//提示错误信息\r\n\t\t\t\t\t\tlet real_res = res.data;\r\n\t\t\t\t\t\tif (real_res.code == -1) {\r\n\t\t\t\t\t\t\tthis.$util.showToast({ title: res.message });\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar payData = res.data.data;\r\n\t\t\t\t\t\tconsole.log(payData)\r\n\t\t\t\t\t\tif (payType.type == 'wechatpay') {\r\n\t\t\t\t\t\t\t// 微信支付\r\n\t\t\t\t\t\t\tthis.wxpay(payData);\r\n\t\t\t\t\t\t} else if (payType.type == 'alipay') {\r\n\t\t\t\t\t\t\t// 支付宝支付\r\n\t\t\t\t\t\t\tconsole.log('alipay')\r\n\t\t\t\t\t\t\tthis.alipay(payData);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// uni.requestPayment({\r\n\t\t\t\t\t\t// \tprovider: payType.provider,\r\n\t\t\t\t\t\t// \ttimeStamp: payData.timeStamp,\r\n\t\t\t\t\t\t// \tnonceStr: payData.nonceStr,\r\n\t\t\t\t\t\t// \tpackage: payData.package,\r\n\t\t\t\t\t\t// \tsignType: payData.signType,\r\n\t\t\t\t\t\t// \tpaySign: payData.paySign,\r\n\t\t\t\t\t\t// \tsuccess: res => {\r\n\t\t\t\t\t\t// \t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, '', 'redirectTo');\r\n\t\t\t\t\t\t// \t},\r\n\t\t\t\t\t\t// \tfail: res => {\r\n\t\t\t\t\t\t// \t\tthis.flag = false;\r\n\t\t\t\t\t\t// \t\tif (res.errMsg == 'requestPayment:fail cancel') {\r\n\t\t\t\t\t\t// \t\t\tthis.$util.showToast({ title: '您已取消支付' });\r\n\t\t\t\t\t\t// \t\t} else {\r\n\t\t\t\t\t\t// \t\t\tuni.showModal({ content: '支付失败,失败原因: ' + res.errMsg, showCancel: false });\r\n\t\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t\t// \t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t// \t\t\tthis.$util.redirectTo(\"/pages/order/list/list\",{},\"redirectTo\")\r\n\t\t\t\t\t\t// \t\t},2000)\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$util.showToast({ title: res.message });\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: res => {\r\n\t\t\t\t\tthis.$util.showToast({ title: 'request:fail' });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\twxpay(payData) {\r\n\t\t\t//uniapp文档地址 https://uniapp.dcloud.io/api/plugins/payment?id=orderinfo\r\n\t\t\t//微信文档地址 https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5\r\n\t\t\tconsole.log(payData)\r\n\t\t\tuni.requestPayment({\r\n\t\t\t\tprovider: 'wxpay', //uniapp规定的微信支付类型\r\n\t\t\t\torderInfo: JSON.stringify(payData),\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res.errMsg == 'requestPayment:ok') {\r\n\t\t\t\t\t\tthis.$util.showToast({\r\n\t\t\t\t\t\t\ttitle: '支付成功',\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, '', 'redirectTo');\r\n\t\t\t\t\t\t\t\t}, 1500);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: res => {\r\n\t\t\t\t\t// this.flag = false;\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tthis.$util.showToast({ title: '您已取消支付' });\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.$util.redirectTo('/pages/order/list/list', {}, 'redirectTo');\r\n\t\t\t\t\t}, 2000);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifdef H5 \r\n\t\tpay() {\r\n\t\t\tvar payType = this.payTypeList[this.payIndex];\r\n\t\t\tif (!payType) return;\r\n\r\n\t\t\tthis.$api.sendRequest({\r\n\t\t\t\turl: '/api/pay/pay',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tout_trade_no: this.payInfo.out_trade_no,\r\n\t\t\t\t\tpay_type: payType.type,\r\n\t\t\t\t\treturn_url: encodeURIComponent(this.$config.h5Domain + '/pages/pay/result/result?code=' + this.payInfo.out_trade_no)\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tif (res.code >= 0) {\r\n\t\t\t\t\t\tswitch (payType.type) {\r\n\t\t\t\t\t\t\tcase 'alipay':\r\n\t\t\t\t\t\t\t\tlocation.href = res.data.data;\r\n\t\t\t\t\t\t\t\tthis.checkPayStatus();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'wechatpay':\r\n\t\t\t\t\t\t\t\tif (this.$util.isWeiXin()) {\r\n\t\t\t\t\t\t\t\t\tif (uni.getSystemInfoSync().platform == 'ios') {\r\n\t\t\t\t\t\t\t\t\t\tvar url = uni.getStorageSync('initUrl');\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tvar url = location.href;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// 获取jssdk配置\r\n\t\t\t\t\t\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\t\t\t\t\t\turl: '/wechat/api/wechat/jssdkconfig',\r\n\t\t\t\t\t\t\t\t\t\tdata: { url: url },\r\n\t\t\t\t\t\t\t\t\t\tsuccess: jssdkRes => {\r\n\t\t\t\t\t\t\t\t\t\t\tvar wxJS = new Weixin(),\r\n\t\t\t\t\t\t\t\t\t\t\t\tpayData = res.data.data;\r\n\t\t\t\t\t\t\t\t\t\t\twxJS.init(jssdkRes.data);\r\n\t\t\t\t\t\t\t\t\t\t\twxJS.pay(\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttimestamp: payData.timestamp,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tnonceStr: payData.nonceStr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpackage: payData.package,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsignType: payData.signType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpaySign: payData.paySign\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tres => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.errMsg == 'chooseWXPay:ok') {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, '', 'redirectTo');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$util.showToast({ title: res.errMsg });\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlocation.href = res.data.url;\r\n\t\t\t\t\t\t\t\t\tthis.checkPayStatus();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$util.showToast({ title: res.message });\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: res => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.$util.showToast({ title: 'request:fail' });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tcheckPayStatus() {\r\n\t\t\tthis.timer = setInterval(() => {\r\n\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\turl: '/api/pay/status',\r\n\t\t\t\t\tdata: { out_trade_no: this.payInfo.out_trade_no },\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.code == 0) {\r\n\t\t\t\t\t\t\tif (res.data.pay_status == 2) {\r\n\t\t\t\t\t\t\t\tclearInterval(this.timer);\r\n\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, '', 'redirectTo');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tclearInterval(this.timer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifdef MP-WEIXIN\r\n\t\tpay() {\r\n\t\t\tvar payType = this.payTypeList[this.payIndex];\r\n\t\t\tif (!payType) return;\r\n\t\t\tif (payType.provider == 'wxpay') {\r\n\t\t\t\tthis.$api.sendRequest({\r\n\t\t\t\t\turl: '/api/pay/pay',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tout_trade_no: this.payInfo.out_trade_no,\r\n\t\t\t\t\t\tpay_type: payType.type\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tif (res.code >= 0) {\r\n\t\t\t\t\t\t\tvar payData = res.data.data;\r\n\t\t\t\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\t\t\t\tprovider: payType.provider,\r\n\t\t\t\t\t\t\t\ttimeStamp: payData.timeStamp,\r\n\t\t\t\t\t\t\t\tnonceStr: payData.nonceStr,\r\n\t\t\t\t\t\t\t\tpackage: payData.package,\r\n\t\t\t\t\t\t\t\tsignType: payData.signType,\r\n\t\t\t\t\t\t\t\tpaySign: payData.paySign,\r\n\t\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, '', 'redirectTo');\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: res => {\r\n\t\t\t\t\t\t\t\t\tthis.flag = false;\r\n\t\t\t\t\t\t\t\t\tif (res.errMsg == 'requestPayment:fail cancel') {\r\n\t\t\t\t\t\t\t\t\t\tthis.$util.showToast({ title: '您已取消支付' });\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.showModal({ content: '支付失败,失败原因: ' + res.errMsg, showCancel: false });\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, 'redirectTo');\r\n\t\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.$util.showToast({ title: res.message });\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tthis.$util.redirectTo('/pages/pay/result/result', { code: this.payInfo.out_trade_no }, 'redirectTo');\r\n\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: res => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tthis.$util.showToast({ title: 'request:fail' });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t// #endif\r\n\t},\r\n\t// #ifdef H5 || APP-PLUS\r\n\tdeactivated() {\r\n\t\tclearInterval(this.timer);\r\n\t},\r\n\t// #endif\r\n\tfilters: {\r\n\t\t/**\r\n\t\t * 金额格式化输出\r\n\t\t * @param {Object} money\r\n\t\t */\r\n\t\tmoneyFormat(money) {\r\n\t\t\treturn parseFloat(money).toFixed(2);\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.popup {\r\n\twidth: 75vw;\r\n\tbackground: #fff;\r\n\tborder-top-left-radius: $border-radius;\r\n\tborder-top-right-radius: $border-radius;\r\n\r\n\t.popup-header {\r\n\t\tdisplay: flex;\r\n\t\tborder-bottom: 2rpx solid $color-line;\r\n\t\tposition: relative;\r\n\t\tpadding: 40rpx;\r\n\r\n\t\t.tit {\r\n\t\t\tflex: 1;\r\n\t\t\tfont-size: $font-size-toolbar;\r\n\t\t\tline-height: 1;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t\t.iconfont {\r\n\t\t\tline-height: 1;\r\n\t\t\tposition: absolute;\r\n\t\t\tright: 30rpx;\r\n\t\t\ttop: 50%;\r\n\t\t\ttransform: translate(0, -50%);\r\n\t\t\tcolor: $color-tip;\r\n\t\t\tfont-size: $font-size-toolbar;\r\n\t\t}\r\n\t}\r\n\r\n\t.popup-body {\r\n\t\theight: calc(100% - 250rpx);\r\n\t\t&.safe-area {\r\n\t\t\theight: calc(100% - 270rpx);\r\n\t\t}\r\n\t}\r\n\r\n\t.popup-footer {\r\n\t\theight: 100rpx;\r\n\r\n\t\t.confirm-btn {\r\n\t\t\theight: 72rpx;\r\n\t\t\tline-height: 72rpx;\r\n\t\t\tcolor: #fff;\r\n\t\t\ttext-align: center;\r\n\t\t\tmargin: 20rpx 30rpx 0;\r\n\t\t\tborder-radius: 40rpx;\r\n\t\t}\r\n\r\n\t\t&.bottom-safe-area {\r\n\t\t\tpadding-bottom: constant(safe-area-inset-bottom);\r\n\t\t\tpadding-bottom: env(safe-area-inset-bottom);\r\n\t\t}\r\n\t}\r\n}\r\n.choose-payment-popup {\r\n\t.payment-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\theight: 90rpx;\r\n\t\tmargin: 0 30rpx;\r\n\t\tborder-bottom: 1px solid $color-line;\r\n\t\tpadding: 20rpx 0;\r\n\t\t&:nth-child(2) {\r\n\t\t\tpadding-top: 0;\r\n\t\t}\r\n\t\t&:last-child {\r\n\t\t\tborder-bottom: none;\r\n\t\t}\r\n\t\t.iconfont {\r\n\t\t\tfont-size: 64rpx;\r\n\t\t}\r\n\t\t.iconyue {\r\n\t\t\tcolor: #faa218;\r\n\t\t}\r\n\t\t.iconweixin1 {\r\n\t\t\tcolor: #24af41;\r\n\t\t}\r\n\t\t.iconzhifubaozhifu- {\r\n\t\t\tcolor: #00a0e9;\r\n\t\t}\r\n\t\t.iconcheckboxblank {\r\n\t\t\tfont-size: 40rpx;\r\n\t\t\tcolor: $color-line;\r\n\t\t}\r\n\t\t.iconyuan_checked {\r\n\t\t\tfont-size: 40rpx;\r\n\t\t}\r\n\t\t.name {\r\n\t\t\tmargin-left: 20rpx;\r\n\t\t\tfont-size: $font-size-base;\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\t\t.info-wrap {\r\n\t\t\tflex: 1;\r\n\t\t\tmargin-left: 20rpx;\r\n\t\t\t.name {\r\n\t\t\t\tmargin-left: 0;\r\n\t\t\t\tfont-size: $font-size-base;\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\t\t\t.money {\r\n\t\t\t\tcolor: $color-tip;\r\n\t\t\t\tfont-size: $font-size-tag;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.box {\r\n\t\t\tflex: 1;\r\n\t\t\tpadding: 0 10rpx;\r\n\t\t\tline-height: inherit;\r\n\t\t\ttext-align: right;\r\n\r\n\t\t\tinput {\r\n\t\t\t\tfont-size: $font-size-tag !important;\r\n\t\t\t}\r\n\t\t}\r\n\t\t&.set-pay-password {\r\n\t\t\theight: initial;\r\n\t\t\t.box {\r\n\t\t\t\tfont-size: $font-size-tag !important;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t.pay-money {\r\n\t\ttext-align: center;\r\n\t\tpadding: 20rpx 0 40rpx 0;\r\n\t\tbackground-color: #fff;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-top: 30rpx;\r\n\t\tline-height: 1;\r\n\t\t.unit {\r\n\t\t\tmargin-right: 4rpx;\r\n\t\t\tfont-size: $font-size-tag;\r\n\t\t}\r\n\t\t.money {\r\n\t\t\tfont-size: $font-size-toolbar;\r\n\t\t}\r\n\t}\r\n}\r\n.empty {\r\n\twidth: 100%;\r\n\ttext-align: center;\r\n\tpadding: 40rpx 0;\r\n\tcolor: $color-sub;\r\n\tfont-size: $font-size-tag;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./payment.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./payment.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1666844730848\n      var cssReload = require(\"/Applications/HBuilderX-Alpha.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}