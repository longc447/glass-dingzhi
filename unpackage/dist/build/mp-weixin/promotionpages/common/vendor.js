(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/common/vendor"],{3263:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:"",platform_coupon_id:0},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],coupon_list:[],invoice_config:{invoice_status:0}},platform_coupon_list:[],bunding_info:{bl_name:""}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,sitePromotion:[],siteDelivery:{site_id:0,data:[]},selectCouponId:0,selectCouponMoney:"0.00",selectPlatCouponId:0,selectPlatCouponMoney:"0.00"}},methods:{openPopup:function(e){"PlatcouponPopup"==e&&(this.selectPlatCouponId=this.orderPaymentData.platform_coupon_id,this.selectPlatCouponMoney=this.orderPaymentData.platform_coupon_money),this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/combo/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("comboOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/bundling/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.coupon={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var e=this.orderPaymentData,t=(new Date).getHours().toString(),i=(new Date).getMinutes().toString();1==t.length&&(t="0"+t),1==i.length&&(i="0"+i);var o=t+":"+i,r=["周日","周一","周二","周三","周四","周五","周六"],a=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=e.shop_goods_list.express_type&&void 0!=e.shop_goods_list.express_type[0]){var s=e.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=s[0].name,this.orderCreateData.delivery.delivery_type_name=s[0].title,this.orderCreateData.delivery.store_id=0,"store"==s[0].name&&void 0!=s[0].store_list[0]&&(this.orderCreateData.delivery.store_id=s[0].store_list[0].store_id)}if(0==e.is_virtual&&e.shop_goods_list.local_config)if(e.shop_goods_list.local_config.info&&1==e.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=o,0==e.shop_goods_list.local_config.info.time_week.length||7==e.shop_goods_list.local_config.info.time_week.length||e.shop_goods_list.local_config.info.time_week.indexOf(a)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==e.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(e.shop_goods_list.local_config.info.time_week.length>0)if(7==e.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;for(var n=e.shop_goods_list.local_config.info.time_week,d=!1,c=0;c<n.length;c++)if(c+1<n.length){var l=n[c+1]-n[c];if(l>1){d=!0;break}}if(d){var u=[];for(c=0;c<n.length;c++)u.push(r[n[c]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=r[n[0]]+"至"+r[n[n.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=e.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=e.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(e.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";if(e.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),void 0!=e.shop_goods_list.coupon_list&&void 0!=e.shop_goods_list.coupon_list[0]){var k=e.shop_goods_list.coupon_list;this.orderCreateData.coupon.coupon_id=k[0].coupon_id,this.orderCreateData.coupon.coupon_money=k[0].money,this.selectCouponId=k[0].coupon_id,this.selectCouponMoney=k[0].coupon_id}e.platform_coupon_list.length>0&&(e.platform_coupon_id=e.platform_coupon_list[0].platformcoupon_id,e.platform_coupon_money=e.platform_coupon_list[0].money,this.orderCreateData.platform_coupon_id=e.platform_coupon_list[0].platformcoupon_id,this.orderCreateData.platform_coupon_money=e.platform_coupon_list[0].money,this.selectPlatCouponId=e.platform_coupon_list[0].platformcoupon_id,this.selectPlatCouponMoney=e.platform_coupon_list[0].money),Object.assign(e,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.coupon;var r={};r[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var a=this.$util.deepClone(this.orderCreateData);a.delivery=JSON.stringify(i),a.coupon=JSON.stringify(o),a.invoice=JSON.stringify(a.invoice),a.member_address=JSON.stringify(a.member_address),a.buyer_message=JSON.stringify(r),this.$api.sendRequest({url:"/bundling/api/ordercreate/calculate",data:a,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.coupon_money=t.data.coupon_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.orderPaymentData.platform_coupon_money=t.data.platform_coupon_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.coupon;var s={};s[o]=this.orderCreateData.buyer_message;var n=this.$util.deepClone(this.orderCreateData);n.delivery=JSON.stringify(r),n.coupon=JSON.stringify(a),n.invoice=JSON.stringify(n.invoice),n.member_address=JSON.stringify(n.member_address),n.buyer_message=JSON.stringify(s),this.$api.sendRequest({url:"/bundling/api/ordercreate/create",data:n,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}return!0},openPromotion:function(){this.$refs.PromotionPopup.open()},openSitePromotion:function(e){this.sitePromotion=e,this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},openSiteCoupon:function(){this.tempData={coupon:this.$util.deepClone(this.orderPaymentData.coupon)},this.selectCouponId=this.orderCreateData.coupon.coupon_id,this.selectCouponMoney=this.orderCreateData.coupon.coupon_money,this.$refs.couponPopup.open()},selectCoupon:function(e){this.selectCouponId!=e.coupon_id?(this.selectCouponId=e.coupon_id,this.selectCouponMoney=e.money):(this.selectCouponId=0,this.selectCouponMoney="0.00"),Object.assign(this.orderPaymentData,this.orderCreateData),this.$forceUpdate()},selectPlatCoupon:function(e){this.selectPlatCouponId!=e.platformcoupon_id?(this.selectPlatCouponId=e.platformcoupon_id,this.selectPlatCouponMoney=e.money):(this.selectPlatCouponId=0,this.selectPlatCouponMoney="0.00"),Object.assign(this.orderPaymentData,this.orderCreateData),this.$forceUpdate()},popupConfirm:function(e){"couponPopup"==e&&(this.orderCreateData.coupon.coupon_id=this.selectCouponId,this.orderCreateData.coupon.coupon_money=this.selectCouponMoney),"PlatcouponPopup"==e&&(this.orderPaymentData.platform_coupon_id=this.selectPlatCouponId,this.orderPaymentData.platform_coupon_money=this.selectPlatCouponMoney,this.orderCreateData.platform_coupon_id=this.selectPlatCouponId,this.orderCreateData.platform_coupon_money=this.selectPlatCouponMoney),this.orderCalculate(),this.$forceUpdate(),this.tempData=null,this.$refs[e].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)},promotionMoney:function(){return this.orderPaymentData.bunding_info.goods_money-this.orderPaymentData.bunding_info.bl_price}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)},promotion:function(e){var t=[];return e&&Object.keys(e).forEach((function(i){e[i];switch(i){case"manjian":t.push("满减送");break;case"freeshipping":t.push("满额包邮");break}})),t.join(" ")}}};t.default=i}).call(this,i("543d")["default"])},"351a":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],invoice_config:{invoice_status:0}}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/bargain/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("bargainOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/bargain/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var e=this.orderPaymentData,t=(new Date).getHours().toString(),i=(new Date).getMinutes().toString();1==t.length&&(t="0"+t),1==i.length&&(i="0"+i);var o=t+":"+i,r=["周日","周一","周二","周三","周四","周五","周六"],a=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=e.shop_goods_list.express_type&&void 0!=e.shop_goods_list.express_type[0]){var s=e.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=s[0].name,this.orderCreateData.delivery.delivery_type_name=s[0].title,this.orderCreateData.delivery.store_id=0,"store"==s[0].name&&void 0!=s[0].store_list[0]&&(this.orderCreateData.delivery.store_id=s[0].store_list[0].store_id)}if(0==e.is_virtual&&e.shop_goods_list.local_config)if(e.shop_goods_list.local_config.info&&1==e.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=o,0==e.shop_goods_list.local_config.info.time_week.length||7==e.shop_goods_list.local_config.info.time_week.length||e.shop_goods_list.local_config.info.time_week.indexOf(a)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==e.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(e.shop_goods_list.local_config.info.time_week.length>0)if(7==e.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;for(var n=e.shop_goods_list.local_config.info.time_week,d=!1,c=0;c<n.length;c++)if(c+1<n.length){var l=n[c+1]-n[c];if(l>1){d=!0;break}}if(d){var u=[];for(c=0;c<n.length;c++)u.push(r[n[c]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=r[n[0]]+"至"+r[n[n.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=e.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=e.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(e.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";e.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(e,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var r=this.$util.deepClone(this.orderCreateData);r.delivery=JSON.stringify(i),r.invoice=JSON.stringify(r.invoice),r.member_address=JSON.stringify(r.member_address),r.buyer_message=JSON.stringify(o),this.$api.sendRequest({url:"/bargain/api/ordercreate/calculate",data:r,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.buyer_message;var s=this.$util.deepClone(this.orderCreateData);s.delivery=JSON.stringify(r),s.invoice=JSON.stringify(s.invoice),s.member_address=JSON.stringify(s.member_address),s.buyer_message=JSON.stringify(a),this.$api.sendRequest({url:"/bargain/api/ordercreate/create",data:s,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}}return!0},openSitePromotion:function(){this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)},bargainPrice:function(){return this.orderPaymentData&&this.orderPaymentData.bargain_info?(Number(this.orderPaymentData.bargain_info.price)-Number(this.orderPaymentData.bargain_info.curr_price)).toFixed(2):0}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},"3e8e":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],invoice_config:{invoice_status:0}},pintuan_info:{},pintuan_group_info:{}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/pintuan/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("pintuanOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/pintuan/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";for(var e=0;e<this.orderPaymentData.shop_goods_list.goods_list.length;e++)this.orderPaymentData.shop_goods_list.goods_list[e].goods_image=this.orderPaymentData.shop_goods_list.goods_list[e].goods_image?this.orderPaymentData.shop_goods_list.goods_list[e].goods_image.split(",")[0]:"";var t=this.orderPaymentData,i=(new Date).getHours().toString(),o=(new Date).getMinutes().toString();1==i.length&&(i="0"+i),1==o.length&&(o="0"+o);var r=i+":"+o,a=["周日","周一","周二","周三","周四","周五","周六"],s=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=t.shop_goods_list.express_type&&void 0!=t.shop_goods_list.express_type[0]){var n=t.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=n[0].name,this.orderCreateData.delivery.delivery_type_name=n[0].title,this.orderCreateData.delivery.store_id=0,"store"==n[0].name&&void 0!=n[0].store_list[0]&&(this.orderCreateData.delivery.store_id=n[0].store_list[0].store_id)}if(0==t.is_virtual&&t.shop_goods_list.local_config)if(t.shop_goods_list.local_config.info&&1==t.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=r,0==t.shop_goods_list.local_config.info.time_week.length||7==t.shop_goods_list.local_config.info.time_week.length||t.shop_goods_list.local_config.info.time_week.indexOf(s)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==t.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(t.shop_goods_list.local_config.info.time_week.length>0)if(7==t.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;var d=t.shop_goods_list.local_config.info.time_week,c=!1;for(e=0;e<d.length;e++)if(e+1<d.length){var l=d[e+1]-d[e];if(l>1){c=!0;break}}if(c){var u=[];for(e=0;e<d.length;e++)u.push(a[d[e]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=a[d[0]]+"至"+a[d[d.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=t.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=t.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(t.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";t.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(t,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var r=this.$util.deepClone(this.orderCreateData);r.delivery=JSON.stringify(i),r.invoice=JSON.stringify(r.invoice),r.member_address=JSON.stringify(r.member_address),r.buyer_message=JSON.stringify(o),this.$api.sendRequest({url:"/pintuan/api/ordercreate/calculate",data:r,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.buyer_message;var s=this.$util.deepClone(this.orderCreateData);s.delivery=JSON.stringify(r),s.invoice=JSON.stringify(s.invoice),s.member_address=JSON.stringify(s.member_address),s.buyer_message=JSON.stringify(a),this.$api.sendRequest({url:"/pintuan/api/ordercreate/create",data:s,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}}return!0},openSitePromotion:function(){this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].goods_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},"4a81":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{groupbuy_id:0,skuId:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.groupbuy_id=t.groupbuy_id||0,this.skuId=t.sku_id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("groupbuy_id")&&(i.groupbuy_id=t.split("-")[1]),-1!=t.indexOf("sku_id")&&(i.skuId=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$langConfig.refresh(),t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.groupbuy){i.next=5;break}t.$util.showToast({title:"团购未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=12;break;case 5:return e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=10,t.getGoodsSkuDetail();case 10:t.modifyGoodsInfo(),t.getEvaluateConfig();case 12:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 2:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id,type:"groupbuy",type_id:this.goodsSkuDetail.groupbuy_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/pages/goods/detail/detail?sku_id="+this.goodsSkuDetail.sku_id)},getGoodsSkuDetail:function(){var t=this;return s(r().mark((function i(){var o,a,s,n,d;return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/groupbuy/api/goods/detail",async:!1,data:{groupbuy_id:t.groupbuy_id}});case 2:if(o=i.sent,a=o.data,null!=a.goods_sku_detail){if(t.goodsSkuDetail=a.goods_sku_detail,t.shopInfo=a.shop_info,t.skuId=t.goodsSkuDetail.sku_id,t.goodsSkuDetail.goods_service=[],1==t.shopInfo.shop_baozh&&t.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==t.shopInfo.shop_qtian&&t.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==t.shopInfo.shop_zhping&&t.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==t.shopInfo.shop_erxiaoshi&&t.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==t.shopInfo.shop_tuihuo&&t.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==t.shopInfo.shop_shiyong&&t.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==t.shopInfo.shop_shiti&&t.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==t.shopInfo.shop_xiaoxie&&t.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),t.goodsSkuDetail.end_time-o.timestamp>0?t.goodsSkuDetail.timeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp):(t.$util.showToast({title:"活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.end_time-o.timestamp>0?t.goodsSkuDetail.timeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp):(t.$util.showToast({title:"活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.video_url&&(t.switchMedia="video"),t.goodsSkuDetail.sku_images?t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.split(","):t.goodsSkuDetail.sku_images=[],t.goodsSkuDetail.goods_spec_format&&t.goodsSkuDetail.goods_image&&(t.goodsSkuDetail.goods_image=t.goodsSkuDetail.goods_image.split(","),t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.concat(t.goodsSkuDetail.goods_image)),t.goodsSkuDetail.unit=t.goodsSkuDetail.unit||"件",t.goodsSkuDetail.show_price=t.goodsSkuDetail.groupbuy_price,t.goodsSkuDetail.save_price=t.goodsSkuDetail.price-t.goodsSkuDetail.show_price>0?(t.goodsSkuDetail.price-t.goodsSkuDetail.show_price).toFixed(2):0,t.goodsSkuDetail.sku_spec_format&&(t.goodsSkuDetail.sku_spec_format=JSON.parse(t.goodsSkuDetail.sku_spec_format)),t.goodsSkuDetail.goods_attr_format)for(s=JSON.parse(t.goodsSkuDetail.goods_attr_format),t.goodsSkuDetail.goods_attr_format=t.$util.unique(s,"attr_id"),n=0;n<t.goodsSkuDetail.goods_attr_format.length;n++)for(d=0;d<s.length;d++)t.goodsSkuDetail.goods_attr_format[n].attr_id==s[d].attr_id&&t.goodsSkuDetail.goods_attr_format[n].attr_value_id!=s[d].attr_value_id&&(t.goodsSkuDetail.goods_attr_format[n].attr_value_name+="、"+s[d].attr_value_name);t.goodsSkuDetail.goods_spec_format&&(t.goodsSkuDetail.goods_spec_format=JSON.parse(t.goodsSkuDetail.goods_spec_format)),t.$langConfig.title(t.goodsSkuDetail.goods_name),t.contactData={title:t.goodsSkuDetail.sku_name,path:"/promotionpages/groupbuy/detail/detail?groupbuy_id="+t.groupbuy_id,img:t.$util.img(t.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&t.getWhetherCollection(),t.setWechatShare(),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.getGoodScircleConfig()}else t.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 5:case"end":return i.stop()}}),i)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/pages/goods/cart/cart",{},"reLaunch")},groupbuy:function(){e.getStorageSync("token")?this.$refs.goodsSku.show("groupbuy",(function(){})):this.$refs.login.open("/promotionpages/groupbuy/detail/detail?groupbuy_id="+this.groupbuy_id+"&sku_id="+this.skuId)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/groupbuy/detail/detail?groupbuy_id="+this.groupbuy_id+"&sku_id="+this.skuId)},getCartCount:function(){var e=this;this.$store.dispatch("getCartNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token")?t.posterHeight=parseInt(1240/r):t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={groupbuy_id:this.groupbuy_id};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/groupbuy/api/goods/poster",data:{page:"/promotionpages/groupbuy/detail/detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t=this.$config.h5Domain+"/promotionpages/groupbuy/detail/detail?groupbuy_id="+this.groupbuy_id;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},"52d5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{mescroll:null,timeList:[],seckillId:null,seckillIndex:null,dataList:[],index:null,siteId:0,timer:null,noStartList:[],showEmpty:!1}},watch:{seckillId:function(e,t){e&&t&&e!=t&&this.mescroll.resetUpScroll(!1)}},computed:{show:function(){return this.timeList.length>0}},methods:{goodsImg:function(e){var t=e.split(",");return t[0]?this.$util.img(t[0],{size:"mid"}):this.$util.getDefaultImage().default_goods_img},transformSeckillTime:function(e){e=parseFloat(e);var t=parseInt(e/3600),i=parseInt(e%3600/60),o=parseInt(e%60);return t<10&&(t="0"+t),i<10&&(i="0"+i),o<10&&(o="0"+o),t+":"+i},isEnd:function(e){e&&this.$util.showToast({title:"限时秒杀活动已结束"})},getTimeList:function(){var e=this;this.$api.sendRequest({url:"/seckill/api/seckill/lists",data:{site_id:this.siteId},success:function(t){var i=t.data;if(i){var o=new Date(1e3*t.timestamp),r=60*o.getHours()*60+60*o.getMinutes()+o.getSeconds(),a=Object.values(i.list);if(a.forEach((function(t,i){t.seckill_start_time<=r&&r<t.seckill_end_time?(t.isNow=!0,e.seckillId=t.id,e.index=i,e.seckillIndex=i):t.isNow=!1})),e.timeList=i.list,a.length){for(var s=Math.round(new Date/1e3),n=Math.round(new Date((new Date).toLocaleDateString()).getTime()/1e3),d=s-n,c=0;c<i.list.length;c++)if((r<i.list[c].seckill_start_time&&0==c||r<i.list[c].seckill_start_time&&r>i.list[c-1].seckill_end_time&&0!=c||c==i.list.length-1&&r>i.list[c].seckill_end_time)&&(e.seckillId=i.list[c].id,e.index=c,e.seckillIndex=c),d<a[c].seckill_start_time){var l=a[c];l.index=c,e.noStartList.push(l)}e.noStartList.length&&e.autoEvent()}var u=e;setInterval((function(e){u.getExpirationTime()}),1e3),e.$refs.loadingCover&&e.$refs.loadingCover.hide()}}})},getData:function(e){var t=this;this.mescroll=e,1==e.size&&(this.dataList=[]),this.$api.sendRequest({url:"/seckill/api/seckillgoods/page",data:{page_size:e.size,page:e.num,seckill_id:this.seckillId,site_id:this.siteId},success:function(i){t.showEmpty=!0;var o=[],r=i.message;0==i.code&&i.data?o=i.data.list:t.$util.showToast({title:r}),e.endSuccess(o.length),1==e.num&&(t.dataList=[]),t.dataList=t.dataList.concat(o),t.$refs.loadingCover&&t.$refs.loadingCover.hide()},fail:function(){e.endErr(),this.$refs.loadingCover&&this.$refs.loadingCover.hide()}})},getExpirationTime:function(){var e,t,i,o=this.timeList,r=new Date,a=r.toLocaleDateString();for(var s in o)if(o[s].isNow){this.ident=!0,t=Date.parse(r),e=Date.parse(a)+1e3*parseInt(o[s].seckill_end_time);var n=(e-t)/1e3;if(i=this.$util.countDown(n),this.hour=i.h,this.minute=i.i,this.second=i.s,0==n){var d=parseInt(s)+1;d<o.length&&(this.index=d),this.timeList[s].isNow=!1}return!1}this.ident=!1},ontabtap:function(e,t){this.seckillId=e,this.seckillIndex=t},toGoodsDetail:function(e,t){var i=this;this.seckillIndex<this.index?this.$util.showToast({title:"秒杀活动已结束！"}):this.seckillIndex>this.index?this.$util.showToast({title:"秒杀活动还未开启，敬请期待！"}):this.$api.sendRequest({url:"/api/config/time",data:{},success:function(o){var r=new Date(1e3*o.timestamp),a=60*r.getHours()*60+60*r.getMinutes()+r.getSeconds();i.timeList[t].seckill_start_time<=a&&a<i.timeList[t].seckill_end_time?i.timeList[t].isNow=!0:i.timeList[t].isNow=!1,i.$forceUpdate(),i.timeList[t].isNow?i.$util.redirectTo("/promotionpages/seckill/detail/detail",{seckill_id:e}):i.$util.showToast({title:"秒杀活动即将开启，敬请期待！"})}})},imgError:function(e){this.dataList[e].goods_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},autoEvent:function(){var e=this;this.timer=setInterval((function(){for(var t=Math.round(new Date/1e3),i=Math.round(new Date((new Date).toLocaleDateString()).getTime()/1e3),o=t-i,r=0;r<e.noStartList.length;r++){var a=e.noStartList[r];o>a.seckill_start_time&&!a.isNow&&(e.seckillId=a.seckill_id,e.index=a.index,e.timeList[a.index].isNow=!0,void 0!=e.timeList[a.index-1]&&(e.timeList[a.index-1].isNow=!1),e.noStartList.splice(r))}0==e.noStartList.length&&clearInterval(e.timer)}),1e3)},goodsTag:function(e){switch(e.recommend_way){case 1:return"新品";case 2:return"精品";case 3:return"推荐";default:return""}}},onShareAppMessage:function(e){return{title:"一大波的秒杀福利就要开始了，真的不来看看嘛",path:"/promotionpages/seckill/list/list",success:function(e){},fail:function(e){}}},onHide:function(){clearInterval(this.timer)}};t.default=o},"5ea1":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{skuId:0,groupId:0,pintuan_id:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},pintuanList:[],currentPintuan:{headimg:"",timeMachine:{}},openPopup:!1,memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,timestamp:"",newList:[],evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.pintuan_id=t.pintuan_id||0,this.groupId=t.group_id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("pintuan_id")&&(i.pintuan_id=t.split("-")[1]),-1!=t.indexOf("group_id")&&(i.group_id=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$langConfig.refresh(),t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.pintuan){i.next=5;break}t.$util.showToast({title:"拼团未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=13;break;case 5:return e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=10,t.getGoodsSkuDetail();case 10:t.modifyGoodsInfo(),t.getEvaluateConfig(),t.getPintuanGroupList();case 13:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 2:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id,type:"pintuan",type_id:this.goodsSkuDetail.pintuan_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/pages/goods/detail/detail?sku_id="+this.goodsSkuDetail.sku_id)},getGoodsSkuDetail:function(){var t=this;return s(r().mark((function i(){var o,a,s,n,d;return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/pintuan/api/goods/detail",async:!1,data:{pintuan_id:t.pintuan_id}});case 2:if(o=i.sent,a=o.data,null!=a.goods_sku_detail){if(t.goodsSkuDetail=a.goods_sku_detail,t.shopInfo=a.shop_info,t.goodsSkuDetail.group_id=t.groupId,t.skuId=t.goodsSkuDetail.sku_id,t.goodsSkuDetail.goods_service=[],1==t.shopInfo.shop_baozh&&t.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==t.shopInfo.shop_qtian&&t.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==t.shopInfo.shop_zhping&&t.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==t.shopInfo.shop_erxiaoshi&&t.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==t.shopInfo.shop_tuihuo&&t.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==t.shopInfo.shop_shiyong&&t.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==t.shopInfo.shop_shiti&&t.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==t.shopInfo.shop_xiaoxie&&t.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),t.goodsSkuDetail.end_time-o.timestamp>0?t.goodsSkuDetail.timeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp):(t.$util.showToast({title:"活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.end_time-o.timestamp>0?t.goodsSkuDetail.timeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp):(t.$util.showToast({title:"活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.video_url&&(t.switchMedia="video"),t.goodsSkuDetail.sku_images?t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.split(","):t.goodsSkuDetail.sku_images=[],t.goodsSkuDetail.goods_spec_format&&t.goodsSkuDetail.goods_image&&(t.goodsSkuDetail.goods_image=t.goodsSkuDetail.goods_image.split(","),t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.concat(t.goodsSkuDetail.goods_image)),t.goodsSkuDetail.unit=t.goodsSkuDetail.unit||"件",t.goodsSkuDetail.show_price=0==t.goodsSkuDetail.group_id?t.goodsSkuDetail.promotion_price:t.goodsSkuDetail.pintuan_price,t.goodsSkuDetail.save_price=t.goodsSkuDetail.price-t.goodsSkuDetail.show_price>0?(t.goodsSkuDetail.price-t.goodsSkuDetail.show_price).toFixed(2):0,t.goodsSkuDetail.sku_spec_format&&(t.goodsSkuDetail.sku_spec_format=JSON.parse(t.goodsSkuDetail.sku_spec_format)),t.goodsSkuDetail.goods_attr_format)for(s=JSON.parse(t.goodsSkuDetail.goods_attr_format),t.goodsSkuDetail.goods_attr_format=t.$util.unique(s,"attr_id"),n=0;n<t.goodsSkuDetail.goods_attr_format.length;n++)for(d=0;d<s.length;d++)t.goodsSkuDetail.goods_attr_format[n].attr_id==s[d].attr_id&&t.goodsSkuDetail.goods_attr_format[n].attr_value_id!=s[d].attr_value_id&&(t.goodsSkuDetail.goods_attr_format[n].attr_value_name+="、"+s[d].attr_value_name);t.goodsSkuDetail.goods_spec_format&&(t.goodsSkuDetail.goods_spec_format=JSON.parse(t.goodsSkuDetail.goods_spec_format)),t.$langConfig.title(t.goodsSkuDetail.goods_name),t.contactData={title:t.goodsSkuDetail.sku_name,path:"/promotionpages/pintuan/detail/detail?pintuan_id="+t.pintuan_id,img:t.$util.img(t.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&t.getWhetherCollection(),t.setWechatShare(),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.getGoodScircleConfig()}else t.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 5:case"end":return i.stop()}}),i)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/pages/goods/cart/cart",{},"reLaunch")},pintuan:function(){var t=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.getStorageSync("token")?(i&&this.resetPrice(),this.$refs.goodsSku.show("pintuan",(function(){t.resetPrice()}))):this.$refs.login.open("/promotionpages/pintuan/detail/detail?pintuan_id="+this.pintuan_id)},buyNow:function(){e.getStorageSync("token")?this.$refs.goodsSku.show("buy_now",(function(){})):this.$refs.login.open("/promotionpages/pintuan/detail/detail?pintuan_id="+this.pintuan_id)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/pintuan/detail/detail?pintuan_id="+this.pintuan_id)},getCartCount:function(){var e=this;this.$store.dispatch("getCartNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token"),t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={id:this.goodsSkuDetail.id};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/pintuan/api/goods/poster",data:{page:"/promotionpages/pintuan/detail/detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},getPintuanGroupList:function(){var e=this;this.$api.sendRequest({url:"/pintuan/api/pintuangroup/lists",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;if(e.timestamp=t.timestamp,null!=i&&i.length){e.pintuanList=i;for(var o=0;o<e.pintuanList.length;o++)e.pintuanList[o]["end_time"]>t.timestamp?(e.pintuanList[o].timeMachine=e.$util.countDown(e.pintuanList[o]["end_time"]-t.timestamp),e.pintuanList[o].currentTime=t.timestamp):e.pintuanList[o].timeMachine=null;e.newList=e.pintuanList.filter((function(e){return e.end_time>t.timestamp})),e.$forceUpdate()}}})},openPinTuan:function(e,t,i,o){var r=this;this.openPopup=!0,this.currentPintuan={groupId:e,pintuan_num:t,timeMachine:this.$util.countDown(i),headimg:o},this.$refs.pintuanPopup.open((function(){r.goodsSkuDetail.group_id=0,r.openPopup=!1}))},closePinTuanPopup:function(){this.$refs.pintuanPopup.close()},joinPintuan:function(){this.closePinTuanPopup(),this.goodsSkuDetail.group_id=this.currentPintuan.groupId,this.goodsSkuDetail.show_price=this.goodsSkuDetail.pintuan_price,this.goodsSkuDetail.save_price=this.goodsSkuDetail.price-this.goodsSkuDetail.show_price>0?(this.goodsSkuDetail.price-this.goodsSkuDetail.show_price).toFixed(2):0,this.$forceUpdate(),this.pintuan(!1)},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},pintuanImgError:function(e){this.pintuanList[e].headimg=this.$util.getDefaultImage().default_headimg,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t=this.$config.h5Domain+"/promotionpages/pintuan/detail/detail?pintuan_id="+this.pintuan_id+"&group_id="+this.groupId;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()},resetPrice:function(){this.goodsSkuDetail.group_id=0,this.goodsSkuDetail.show_price=this.goodsSkuDetail.promotion_price,this.goodsSkuDetail.save_price=this.goodsSkuDetail.price-this.goodsSkuDetail.show_price>0?(this.goodsSkuDetail.price-this.goodsSkuDetail.show_price).toFixed(2):0,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},"84c8":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],invoice_config:{invoice_status:0}},groupbuy_info:{name:""}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/groupbuy/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("groupbuyOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/groupbuy/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";for(var e=0;e<this.orderPaymentData.shop_goods_list.goods_list.length;e++)this.orderPaymentData.shop_goods_list.goods_list[e].goods_image=this.orderPaymentData.shop_goods_list.goods_list[e].goods_image?this.orderPaymentData.shop_goods_list.goods_list[e].goods_image.split(",")[0]:"";var t=this.orderPaymentData,i=(new Date).getHours().toString(),o=(new Date).getMinutes().toString();1==i.length&&(i="0"+i),1==o.length&&(o="0"+o);var r=i+":"+o,a=["周日","周一","周二","周三","周四","周五","周六"],s=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=t.shop_goods_list.express_type&&void 0!=t.shop_goods_list.express_type[0]){var n=t.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=n[0].name,this.orderCreateData.delivery.delivery_type_name=n[0].title,this.orderCreateData.delivery.store_id=0,"store"==n[0].name&&void 0!=n[0].store_list[0]&&(this.orderCreateData.delivery.store_id=n[0].store_list[0].store_id)}if(0==t.is_virtual&&t.shop_goods_list.local_config)if(t.shop_goods_list.local_config.info&&1==t.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=r,0==t.shop_goods_list.local_config.info.time_week.length||7==t.shop_goods_list.local_config.info.time_week.length||t.shop_goods_list.local_config.info.time_week.indexOf(s)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==t.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(t.shop_goods_list.local_config.info.time_week.length>0)if(7==t.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;var d=t.shop_goods_list.local_config.info.time_week,c=!1;for(e=0;e<d.length;e++)if(e+1<d.length){var l=d[e+1]-d[e];if(l>1){c=!0;break}}if(c){var u=[];for(e=0;e<d.length;e++)u.push(a[d[e]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=a[d[0]]+"至"+a[d[d.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=t.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=t.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(t.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";t.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(t,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var r=this.$util.deepClone(this.orderCreateData);r.delivery=JSON.stringify(i),r.invoice=JSON.stringify(r.invoice),r.member_address=JSON.stringify(r.member_address),r.buyer_message=JSON.stringify(o),this.$api.sendRequest({url:"/groupbuy/api/ordercreate/calculate",data:r,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.buyer_message;var s=this.$util.deepClone(this.orderCreateData);s.delivery=JSON.stringify(r),s.invoice=JSON.stringify(s.invoice),s.member_address=JSON.stringify(s.member_address),s.buyer_message=JSON.stringify(a),this.$api.sendRequest({url:"/groupbuy/api/ordercreate/create",data:s,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}}return!0},openSitePromotion:function(){this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].goods_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},8920:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{seckill_id:0,skuId:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.seckill_id=t.seckill_id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("seckill_id")&&(i.seckill_id=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.seckill){i.next=5;break}t.$util.showToast({title:"秒杀未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=13;break;case 5:return t.$langConfig.refresh(),e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=11,t.getGoodsSkuDetail();case 11:t.modifyGoodsInfo(),t.getEvaluateConfig();case 13:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 1:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id,type:"seckill",type_id:this.goodsSkuDetail.seckill_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/promotionpages/seckill/detail/detail?seckill_id="+this.seckill_id)},getGoodsSkuDetail:function(){var t=this;return s(r().mark((function i(){var o,a,s,n,d,c,l;return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/seckill/api/seckillgoods/detail",async:!1,data:{seckill_id:t.seckill_id}});case 2:if(o=i.sent,a=o.data,null!=a.goods_sku_detail){if(t.goodsSkuDetail=a.goods_sku_detail,t.shopInfo=a.shop_info,t.skuId=t.goodsSkuDetail.sku_id,t.goodsSkuDetail.goods_service=[],1==t.shopInfo.shop_baozh&&t.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==t.shopInfo.shop_qtian&&t.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==t.shopInfo.shop_zhping&&t.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==t.shopInfo.shop_erxiaoshi&&t.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==t.shopInfo.shop_tuihuo&&t.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==t.shopInfo.shop_shiyong&&t.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==t.shopInfo.shop_shiti&&t.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==t.shopInfo.shop_xiaoxie&&t.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),s=new Date(1e3*o.timestamp),n=60*s.getHours()*60+60*s.getMinutes()+s.getSeconds(),t.goodsSkuDetail.seckill_start_time<=n&&n<t.goodsSkuDetail.seckill_end_time?t.goodsSkuDetail.discountTimeMachine=t.$util.countDown(t.goodsSkuDetail.seckill_end_time-n):t.goodsSkuDetail.seckill_start_time>n&&n<t.goodsSkuDetail.seckill_end_time?(t.$util.showToast({title:"限时秒杀活动还未开始"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)):n<t.goodsSkuDetail.seckill_start_time&&n>t.goodsSkuDetail.seckill_end_time&&(t.$util.showToast({title:"限时秒杀活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.show_price=t.goodsSkuDetail.seckill_price,t.goodsSkuDetail.video_url&&(t.switchMedia="video"),t.goodsSkuDetail.sku_images?t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.split(","):t.goodsSkuDetail.sku_images=[],t.goodsSkuDetail.goods_spec_format&&t.goodsSkuDetail.goods_image&&(t.goodsSkuDetail.goods_image=t.goodsSkuDetail.goods_image.split(","),t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.concat(t.goodsSkuDetail.goods_image)),t.goodsSkuDetail.unit=t.goodsSkuDetail.unit||"件",t.goodsSkuDetail.save_price=t.goodsSkuDetail.price-t.goodsSkuDetail.seckill_price>0?(t.goodsSkuDetail.price-t.goodsSkuDetail.seckill_price).toFixed(2):0,t.goodsSkuDetail.sku_spec_format&&(t.goodsSkuDetail.sku_spec_format=JSON.parse(t.goodsSkuDetail.sku_spec_format)),t.goodsSkuDetail.goods_attr_format)for(d=JSON.parse(t.goodsSkuDetail.goods_attr_format),t.goodsSkuDetail.goods_attr_format=t.$util.unique(d,"attr_id"),c=0;c<t.goodsSkuDetail.goods_attr_format.length;c++)for(l=0;l<d.length;l++)t.goodsSkuDetail.goods_attr_format[c].attr_id==d[l].attr_id&&t.goodsSkuDetail.goods_attr_format[c].attr_value_id!=d[l].attr_value_id&&(t.goodsSkuDetail.goods_attr_format[c].attr_value_name+="、"+d[l].attr_value_name);t.goodsSkuDetail.goods_spec_format&&(t.goodsSkuDetail.goods_spec_format=JSON.parse(t.goodsSkuDetail.goods_spec_format)),t.$langConfig.title(t.goodsSkuDetail.goods_name),t.contactData={title:t.goodsSkuDetail.sku_name,path:"/promotionpages/seckill/detail/detail?seckill_id="+t.seckill_id,img:t.$util.img(t.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&t.getWhetherCollection(),t.setWechatShare(),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.getGoodScircleConfig()}else t.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 5:case"end":return i.stop()}}),i)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/pages/goods/cart/cart",{},"reLaunch")},seckill:function(){e.getStorageSync("token")?this.$refs.goodsSku.show("seckill",(function(){})):this.$refs.login.open("/promotionpages/seckill/detail/detail?seckill_id="+this.seckill_id)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/seckill/detail/detail?seckill_id="+this.seckill_id)},getCartCount:function(){var e=this;this.$store.dispatch("getCartNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token")?t.posterHeight=parseInt(1240/r):t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={id:this.goodsSkuDetail.goods_id};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/seckill/api/seckillgoods/poster",data:{page:"/promotionpages/seckill/detail/detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t=this.$config.h5Domain+"/promotionpages/seckill/detail/detail?seckill_id="+this.seckill_id;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},"9c8e":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{topics_id:0,skuId:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.topics_id=t.id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("id")&&(i.topics_id=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$langConfig.refresh(),t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.topic){i.next=5;break}t.$util.showToast({title:"专题活动未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=12;break;case 5:return e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=10,t.getGoodsSkuDetail();case 10:t.modifyGoodsInfo(),t.getEvaluateConfig();case 12:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 2:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/pages/goods/detail/detail?sku_id="+this.goodsSkuDetail.sku_id)},getGoodsSkuDetail:function(){var t=this;return s(r().mark((function i(){var o,a,s,n,d;return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/topic/api/topicgoods/detail",async:!1,data:{topic_id:t.topics_id}});case 2:if(o=i.sent,a=o.data,null!=a.goods_sku_detail){if(t.goodsSkuDetail=a.goods_sku_detail,t.shopInfo=a.shop_info,t.skuId=t.goodsSkuDetail.sku_id,t.goodsSkuDetail.goods_service=[],1==t.shopInfo.shop_baozh&&t.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==t.shopInfo.shop_qtian&&t.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==t.shopInfo.shop_zhping&&t.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==t.shopInfo.shop_erxiaoshi&&t.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==t.shopInfo.shop_tuihuo&&t.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==t.shopInfo.shop_shiyong&&t.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==t.shopInfo.shop_shiti&&t.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==t.shopInfo.shop_xiaoxie&&t.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),o.timestamp>t.goodsSkuDetail.end_time?(t.$util.showToast({title:"专题活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)):t.goodsSkuDetail.discountTimeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp),t.goodsSkuDetail.show_price=t.goodsSkuDetail.topic_price,t.goodsSkuDetail.video_url&&(t.switchMedia="video"),t.goodsSkuDetail.sku_images?t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.split(","):t.goodsSkuDetail.sku_images=[],t.goodsSkuDetail.goods_spec_format&&t.goodsSkuDetail.goods_image&&(t.goodsSkuDetail.goods_image=t.goodsSkuDetail.goods_image.split(","),t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.concat(t.goodsSkuDetail.goods_image)),t.goodsSkuDetail.unit=t.goodsSkuDetail.unit||"件",t.goodsSkuDetail.save_price=t.goodsSkuDetail.price-t.goodsSkuDetail.show_price>0?(t.goodsSkuDetail.price-t.goodsSkuDetail.show_price).toFixed(2):0,t.goodsSkuDetail.sku_spec_format&&(t.goodsSkuDetail.sku_spec_format=JSON.parse(t.goodsSkuDetail.sku_spec_format)),t.goodsSkuDetail.goods_attr_format)for(s=JSON.parse(t.goodsSkuDetail.goods_attr_format),t.goodsSkuDetail.goods_attr_format=t.$util.unique(s,"attr_id"),n=0;n<t.goodsSkuDetail.goods_attr_format.length;n++)for(d=0;d<s.length;d++)t.goodsSkuDetail.goods_attr_format[n].attr_id==s[d].attr_id&&t.goodsSkuDetail.goods_attr_format[n].attr_value_id!=s[d].attr_value_id&&(t.goodsSkuDetail.goods_attr_format[n].attr_value_name+="、"+s[d].attr_value_name);t.goodsSkuDetail.goods_spec_format&&(t.goodsSkuDetail.goods_spec_format=JSON.parse(t.goodsSkuDetail.goods_spec_format)),t.$langConfig.title(t.goodsSkuDetail.goods_name),t.contactData={title:t.goodsSkuDetail.sku_name,path:"/promotionpages/topic/detail/detail?id="+t.topics_id,img:t.$util.img(t.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&t.getWhetherCollection(),t.setWechatShare(),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.getGoodScircleConfig()}else t.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 5:case"end":return i.stop()}}),i)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/pages/goods/cart/cart",{},"reLaunch")},topic:function(){e.getStorageSync("token")?this.$refs.goodsSku.show("topic",(function(){})):this.$refs.login.open("/promotionpages/topics/goods_detail/goods_detail?id="+this.topics_id)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/topics/goods_detail/goods_detail?id="+this.topics_id)},getCartCount:function(){var e=this;this.$store.dispatch("getCartNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token")?t.posterHeight=parseInt(1240/r):t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={id:this.topics_id};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/topic/api/topicgoods/poster",data:{page:"/promotionpages/topics/goods_detail/goods_detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t=this.$config.h5Domain+"/promotionpages/topic/goods_detail/goods_detail?id="+this.topics_id;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},a392:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],invoice_config:{invoice_status:0}},seckill_info:{name:""}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/seckill/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("seckillOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/seckill/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var e=this.orderPaymentData,t=(new Date).getHours().toString(),i=(new Date).getMinutes().toString();1==t.length&&(t="0"+t),1==i.length&&(i="0"+i);var o=t+":"+i,r=["周日","周一","周二","周三","周四","周五","周六"],a=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=e.shop_goods_list.express_type&&void 0!=e.shop_goods_list.express_type[0]){var s=e.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=s[0].name,this.orderCreateData.delivery.delivery_type_name=s[0].title,this.orderCreateData.delivery.store_id=0,"store"==s[0].name&&void 0!=s[0].store_list[0]&&(this.orderCreateData.delivery.store_id=s[0].store_list[0].store_id)}if(0==e.is_virtual&&e.shop_goods_list.local_config)if(e.shop_goods_list.local_config.info&&1==e.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=o,0==e.shop_goods_list.local_config.info.time_week.length||7==e.shop_goods_list.local_config.info.time_week.length||e.shop_goods_list.local_config.info.time_week.indexOf(a)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==e.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(e.shop_goods_list.local_config.info.time_week.length>0)if(7==e.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;for(var n=e.shop_goods_list.local_config.info.time_week,d=!1,c=0;c<n.length;c++)if(c+1<n.length){var l=n[c+1]-n[c];if(l>1){d=!0;break}}if(d){var u=[];for(c=0;c<n.length;c++)u.push(r[n[c]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=r[n[0]]+"至"+r[n[n.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=e.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=e.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(e.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";e.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(e,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var r=this.$util.deepClone(this.orderCreateData);r.delivery=JSON.stringify(i),r.invoice=JSON.stringify(r.invoice),r.member_address=JSON.stringify(r.member_address),r.buyer_message=JSON.stringify(o),this.$api.sendRequest({url:"/seckill/api/ordercreate/calculate",data:r,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.buyer_message;var s=this.$util.deepClone(this.orderCreateData);s.delivery=JSON.stringify(r),s.invoice=JSON.stringify(s.invoice),s.member_address=JSON.stringify(s.member_address),s.buyer_message=JSON.stringify(a),this.$api.sendRequest({url:"/seckill/api/ordercreate/create",data:s,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}}return!0},openSitePromotion:function(){this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},aaa7:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{skuId:0,goodsId:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.skuId=t.sku_id||0,this.goodsId=t.goods_id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("sku_id")&&(i.skuId=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.wholesale){i.next=5;break}t.$util.showToast({title:"批发活动未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=13;break;case 5:return t.$langConfig.refresh(),e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=11,t.getGoodsSkuDetail();case 11:t.modifyGoodsInfo(),t.getEvaluateConfig();case 13:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 1:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/pages/goods/detail/detail?sku_id="+this.goodsSkuDetail.sku_id)},getGoodsSkuDetail:function(t){var i=this;return s(r().mark((function o(){var a,s,n,d,c;return r().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i.skuId=t||i.skuId,o.next=3,i.$api.sendRequest({url:"/wholesale/api/goods/detail",async:!1,data:{goods_id:i.goodsId}});case 3:if(a=o.sent,s=a.data,null!=s.goods_sku_detail){if(i.goodsSkuDetail=s.goods_sku_detail,i.shopInfo=s.shop_info,i.skuId=i.goodsSkuDetail.sku_id,i.goodsSkuDetail.goods_service=[],1==i.shopInfo.shop_baozh&&i.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==i.shopInfo.shop_qtian&&i.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==i.shopInfo.shop_zhping&&i.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==i.shopInfo.shop_erxiaoshi&&i.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==i.shopInfo.shop_tuihuo&&i.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==i.shopInfo.shop_shiyong&&i.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==i.shopInfo.shop_shiti&&i.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==i.shopInfo.shop_xiaoxie&&i.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),i.goodsSkuDetail.video_url&&(i.switchMedia="video"),i.goodsSkuDetail.sku_images?i.goodsSkuDetail.sku_images=i.goodsSkuDetail.sku_images.split(","):i.goodsSkuDetail.sku_images=[],i.goodsSkuDetail.goods_spec_format&&i.goodsSkuDetail.goods_image&&(i.goodsSkuDetail.goods_image=i.goodsSkuDetail.goods_image.split(","),i.goodsSkuDetail.sku_images=i.goodsSkuDetail.sku_images.concat(i.goodsSkuDetail.goods_image)),i.goodsSkuDetail.unit=i.goodsSkuDetail.unit||"件",i.goodsSkuDetail.sku_spec_format&&(i.goodsSkuDetail.sku_spec_format=JSON.parse(i.goodsSkuDetail.sku_spec_format)),i.goodsSkuDetail.goods_attr_format)for(n=JSON.parse(i.goodsSkuDetail.goods_attr_format),i.goodsSkuDetail.goods_attr_format=i.$util.unique(n,"attr_id"),d=0;d<i.goodsSkuDetail.goods_attr_format.length;d++)for(c=0;c<n.length;c++)i.goodsSkuDetail.goods_attr_format[d].attr_id==n[c].attr_id&&i.goodsSkuDetail.goods_attr_format[d].attr_value_id!=n[c].attr_value_id&&(i.goodsSkuDetail.goods_attr_format[d].attr_value_name+="、"+n[c].attr_value_name);i.goodsSkuDetail.goods_spec_format&&(i.goodsSkuDetail.goods_spec_format=JSON.parse(i.goodsSkuDetail.goods_spec_format)),i.$langConfig.title(i.goodsSkuDetail.goods_name),i.contactData={title:i.goodsSkuDetail.sku_name,path:"/promotionpages/wholesale/detail/detail?sku_id="+i.skuId,img:i.$util.img(i.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&i.getWhetherCollection(),i.setWechatShare(),i.$refs.loadingCover&&i.$refs.loadingCover.hide(),i.getGoodScircleConfig()}else i.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 6:case"end":return o.stop()}}),o)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/promotionpages/wholesale/cartList/cartList")},wholesaleJoinCart:function(){var t=this;e.getStorageSync("token")?this.$refs.goodsSku.show("wholesale_join_cart",(function(){t.getCartCount()})):this.$refs.login.open("/promotionpages/wholesale/detail/detail?sku_id="+this.skuId)},wholesaleBuyNow:function(){var t=this;e.getStorageSync("token")?this.$refs.goodsSku.show("wholesale_buy_now",(function(){t.getCartCount()})):this.$refs.login.open("/promotionpages/wholesale/detail/detail?sku_id="+this.skuId)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/wholesale/detail/detail?sku_id="+this.skuId)},getCartCount:function(){var e=this;this.$store.dispatch("getWholeSaleNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token")?t.posterHeight=parseInt(1120/r):t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={goods_id:this.goodsId};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/wholesale/api/goods/poster",data:{page:"/promotionpages/wholesale/detail/detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t="【"+this.goodsSkuDetail.sku_name+"】发现好物，一起来看看吧。"+this.$config.h5Domain+"/promotionpages/wholesale/detail/detail?goods_id="+this.goodsId;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},afa9:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{},orderPaymentData:{exchange_info:{type:0}},type:1,isSub:!1}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/point/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("exchangeOrderCreateData");var i=e.getStorageSync("pay_flag");this.orderCreateData?(this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/pointexchange/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})):1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},orderCreate:function(){var t=this;if(this.verify()){if(this.isSub)return;this.isSub=!0;var i=this.$util.deepClone(this.orderCreateData);i.delivery=JSON.stringify(i.delivery),i.member_address=JSON.stringify(i.member_address),this.$api.sendRequest({url:"/pointexchange/api/ordercreate/create",data:i,success:function(i){i.code>=0?1==t.orderPaymentData.exchange_info.pay_type&&"0.00"!=t.orderPaymentData.exchange_info.price?(t.$refs.choosePaymentPopup.getPayInfo(i.data),t.isSub=!1):t.$util.redirectTo("/promotionpages/point/result/result",{},"redirectTo"):(t.isSub=!1,10==i.data.error_code||12==i.data.error_code?e.showModal({title:"订单未创建",content:i.message,confirmText:"去设置",success:function(e){e.confirm&&t.selectAddress()}}):t.$util.showToast({title:i.message}))},fail:function(i){e.hideLoading(),t.isSub=!1}})}},verify:function(){return!(1==this.orderPaymentData.exchange_info.type&&!this.orderPaymentData.member_address)||(this.$util.showToast({title:"请先选择您的收货地址"}),!1)},imgError:function(){var e="";e=1==this.orderPaymentData.exchange_info.type?this.$util.img("upload/uniapp/point/gift.png"):2==this.orderPaymentData.exchange_info.type?this.$util.img("upload/uniapp/point/coupon.png"):3==this.orderPaymentData.exchange_info.type?this.$util.img("upload/uniapp/point/hongbao.png"):this.$util.getDefaultImage().default_goods_img,this.orderPaymentData.exchange_info.image=e,this.$forceUpdate()},openChoosePayment:function(){this.verify()&&1==this.orderPaymentData.exchange_info.pay_type&&"0.00"!=this.orderPaymentData.exchange_info.price?this.$refs.choosePaymentPopup.open():this.orderCreate()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},b045:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,Function.prototype.asyAfter=function(e){var t=this;return function(){var i=t.apply(this,arguments);return"next"===i?e.apply(this,arguments):i}},Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"}[this.getDay()+""])),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var o=function(){},r=o.prototype;r.getUnix=function(){return(new Date).getTime()},r.getTodayUnix=function(){var e=new Date,t="".concat(e.getFullYear(),"/").concat(e.getMonth()+1,"/").concat(e.getDate()," 00:00:00");return new Date(t).getTime()},r.getYearUnix=function(){var e=new Date;return e.setMonth(0),e.setDate(1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getTime()},r.getLastDate=function(e){if(e){var t=new Date(e);if(t.pattern)return t.pattern("yyyy-MM-dd");var i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"-"+i+"-"+o}};var a=new RegExp("-","g");r.getFormatTime=function(e,t){if(!e)return"";switch(function(e){return/^\[object\s(.*)\]$/.exec(Object.prototype.toString.call(e))[1]}(e)){case"Date":e=e.getTime();break;case"String":e=e.replace(a,"/");default:e=new Date(e).getTime();break}var i=this.getUnix(),o=(this.getYearUnix(),(i-e)/1e3);if(e>i&&t)return this.getLastDate(e);return function(e,t){var i=function(e){return e<=0||Math.floor(e/60)<=0?"刚刚":"next"}.asyAfter((function(e){return e<3600?Math.floor(e/60)+"分钟前":"next"})).asyAfter((function(e,t){var i=s.getTodayUnix();return e>=3600&&t-i>=0?Math.floor(e/60/60)+"小时前":"next"})).asyAfter((function(e,t){var i=s.getTodayUnix();return e=(i-t)/1e3,e/86400<=31?Math.ceil(e/86400)+"天前":"next"})).asyAfter((function(e,t){return s.getLastDate(t)}));return i(e,t)}(o,e)};var s=new o,n=s;t.default=n},b212:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/wholesale/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("wholesaleOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.$api.sendRequest({url:"/wholesale/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){var e=this;this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.coupon={},this.orderCreateData.buyer_message={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var t=this.orderPaymentData,i=(new Date).getHours().toString(),o=(new Date).getMinutes().toString();1==i.length&&(i="0"+i),1==o.length&&(o="0"+o);var r=i+":"+o,a=["周日","周一","周二","周三","周四","周五","周六"],s=["0","1","2","3","4","5","6"][(new Date).getDay()];Object.keys(t.shop_goods_list).forEach((function(i,o){var n=t.shop_goods_list[i];if(e.orderCreateData.delivery[i]={},void 0!=n.express_type[0]&&(e.orderCreateData.delivery[i].delivery_type=n.express_type[0].name,e.orderCreateData.delivery[i].delivery_type_name=n.express_type[0].title,e.orderCreateData.delivery[i].store_id=0,"store"==n.express_type[0].name&&void 0!=n.express_type[0].store_list[0]&&(e.orderCreateData.delivery[i].store_id=n.express_type[0].store_list[0].store_id)),0==t.is_virtual&&n.local_config)if(n.local_config.info&&1==n.local_config.info.time_is_open){if(e.orderCreateData.delivery[i].showTimeBar=!0,e.orderCreateData.delivery[i].buyer_ask_delivery_time=r,0==n.local_config.info.time_week.length||7==n.local_config.info.time_week.length||n.local_config.info.time_week.indexOf(s)>-1?e.orderCreateData.delivery[i].canLocalDelicery=!0:e.orderCreateData.delivery[i].canLocalDelicery=!1,0==n.local_config.info.time_type)e.orderCreateData.delivery[i].deliveryWeek="全天";else if(n.local_config.info.time_week.length>0)if(7==n.local_config.info.time_week.length)e.orderCreateData.delivery[i].deliveryWeek="全天",e.orderCreateData.delivery[i].showTime=!1;else{e.orderCreateData.delivery[i].showTime=!0;for(var d=n.local_config.info.time_week,c=!1,l=0;l<d.length;l++)if(l+1<d.length){var u=d[l+1]-d[l];if(u>1){c=!0;break}}if(c){var h=[];for(l=0;l<d.length;l++)h.push(a[d[l]]);e.orderCreateData.delivery[i].deliveryWeek=h.join("、")}else e.orderCreateData.delivery[i].deliveryWeek=a[d[0]]+"至"+a[d[d.length-1]]}else e.orderCreateData.delivery[i].deliveryWeek="店铺未设置配送时间";var p=n.local_config.info.start_time;e.orderCreateData.delivery[i].start_time=e.getTimeStr(p);var _=n.local_config.info.end_time;e.orderCreateData.delivery[i].end_time=e.getTimeStr(_);var g=new Date(e.$util.timeStampTurnTime(t.timestamp)),f=g.getHours(),v=g.getMinutes(),m=parseInt(e.orderCreateData.delivery[i].start_time.split(":")[0]),y=parseInt(e.orderCreateData.delivery[i].start_time.split(":")[1]),D=parseInt(e.orderCreateData.delivery[i].end_time.split(":")[0]),k=parseInt(e.orderCreateData.delivery[i].end_time.split(":")[1]);e.orderCreateData.delivery[i].canLocalDelicery&&(m==D&&y==k||((f<m||f==m&&v<y)&&(e.orderCreateData.delivery[i].buyer_ask_delivery_time=(1==m.toString().length?"0"+m:m)+":"+(1==y.toString().length?"0"+y:y)),(f>D||f==D&&v>k)&&(e.orderCreateData.delivery[i].canLocalDelicery=!1)))}else e.orderCreateData.delivery[i].showTimeBar=!1,e.orderCreateData.delivery[i].deliveryWeek="店铺未开启配送时间";n.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),e.orderCreateData.buyer_message[i]=""})),t.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(t,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this;Object.keys(this.orderPaymentData.shop_goods_list).forEach((function(t,i){var o=e.orderPaymentData.shop_goods_list[t];o.is_invoice&&(e.orderCreateData.invoice[t]={},Array.isArray(o.invoice_config)||(e.orderCreateData.invoice[t].is_invoice=o.is_invoice,e.orderCreateData.invoice[t].invoice_type=o.invoice_type,e.orderCreateData.invoice[t].invoice_title=o.invoice_title,e.orderCreateData.invoice[t].taxpayer_number=o.taxpayer_number,e.orderCreateData.invoice[t].invoice_content=o.invoice_content,e.orderCreateData.invoice[t].invoice_full_address=o.invoice_full_address,e.orderCreateData.invoice[t].is_tax_invoice=o.is_tax_invoice,e.orderCreateData.invoice[t].invoice_email=o.invoice_email,e.orderCreateData.invoice[t].invoice_title_type=o.invoice_title_type))}));var t=this.$util.deepClone(this.orderCreateData);t.delivery=JSON.stringify(t.delivery),t.invoice=JSON.stringify(t.invoice),t.member_address=JSON.stringify(t.member_address),this.$api.sendRequest({url:"/wholesale/api/ordercreate/calculate",data:t,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,Object.keys(t.data.shop_goods_list).forEach((function(i,o){var r=t.data.shop_goods_list[i];e.orderPaymentData.shop_goods_list[i].order_money=r.order_money,e.orderPaymentData.shop_goods_list[i].pay_money=r.pay_money,e.orderPaymentData.shop_goods_list[i].invoice_money=r.invoice_money,e.orderPaymentData.shop_goods_list[i].invoice_delivery_money=r.invoice_delivery_money})),e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.$util.deepClone(this.orderCreateData);o.delivery=JSON.stringify(o.delivery),o.coupon=JSON.stringify(o.coupon),o.invoice=JSON.stringify(o.invoice),o.member_address=JSON.stringify(o.member_address),o.buyer_message=JSON.stringify(o.buyer_message),this.$api.sendRequest({url:"/wholesale/api/ordercreate/create",data:o,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message})),i.$store.dispatch("getWholeSaleNumber")},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list[t].express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[t].site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;var i=!0;for(var o in this.orderCreateData.delivery){if("{}"==JSON.stringify(this.orderCreateData.delivery[o])){i=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[o].site_name+"】未设置配送方式"});break}if("store"==this.orderCreateData.delivery[o].delivery_type&&0==this.orderCreateData.delivery[o].store_id){i=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[o].site_name+"】没有可提货的门店,请选择其他配送方式"});break}if("local"==this.orderCreateData.delivery[o].delivery_type){if(!this.orderCreateData.delivery[o].canLocalDelicery){this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[o].site_name+"】已休息"}),i=!1;break}var r=parseInt(this.orderCreateData.delivery[o].buyer_ask_delivery_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery[o].buyer_ask_delivery_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery[o].start_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery[o].start_time.split(":")[1]),d=parseInt(this.orderCreateData.delivery[o].end_time.split(":")[0]),c=parseInt(this.orderCreateData.delivery[o].end_time.split(":")[1]);if(s!=d||n!=c){if(r<s||r==s&&a<n){this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[o].site_name+"】送达时间不能小于配送开始时间"}),i=!1;break}if(!(r>s&&r<d||r==s&&a>n||r==s&&a>=n&&r<d)){this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list[o].site_name+"】送达时间范围：开始时间~结束时间"}),i=!1;break}}}}if(!i)return!1}return!0},openSiteDelivery:function(e,t){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.siteDelivery.site_id=e,this.siteDelivery.data=t,this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery[this.siteDelivery.site_id].delivery_type=e.name,this.orderCreateData.delivery[this.siteDelivery.site_id].delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery[this.siteDelivery.site_id].store_id=e.store_list[0].store_id,this.tempData.delivery[this.siteDelivery.site_id].store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery[this.siteDelivery.site_id].store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e,t){this.orderPaymentData.shop_goods_list[e].goods_list[t].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list[this.orderInvoice.site_id]=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/promotionpages/wholesale/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])},c1e4:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i("67eb"));i("4ffd");function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",n=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(I){d=function(e,t,i){return e[t]=i}}function c(e,t,i,o){var r=t&&t.prototype instanceof h?t:h,a=Object.create(r.prototype),s=new w(o||[]);return a._invoke=function(e,t,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return $()}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var n=k(s,i);if(n){if(n===u)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=l(e,t,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}(e,i,s),a}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(I){return{type:"throw",arg:I}}}e.wrap=c;var u={};function h(){}function p(){}function _(){}var g={};d(g,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==t&&i.call(v,a)&&(g=v);var m=_.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){var o;this._invoke=function(r,a){function s(){return new t((function(o,s){(function o(r,a,s,n){var d=l(e[r],e,a);if("throw"!==d.type){var c=d.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,s,n)}),(function(e){o("throw",e,s,n)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return o("throw",e,s,n)}))}n(d.arg)})(r,a,o,s)}))}return o=o?o.then(s,s):s()}}function k(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=l(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:$}}function $(){return{value:void 0,done:!0}}return p.prototype=_,d(m,"constructor",_),d(_,"constructor",p),p.displayName=d(_,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,n,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(D.prototype),d(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,i,o,r,a){void 0===a&&(a=Promise);var s=new D(c(t,i,o,r),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(m),d(m,n,"Generator"),d(m,a,(function(){return this})),d(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var o=t.pop();if(o in e)return i.value=o,i.done=!1,i}return i.done=!0,i}},e.values=b,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var n=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(n&&d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(n){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var o=i.completion;if("throw"===o.type){var r=o.arg;C(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:b(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,o,r,a,s){try{var n=e[a](s),d=n.value}catch(c){return void i(c)}n.done?t(d):Promise.resolve(d).then(o,r)}function s(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var s=e.apply(t,i);function n(e){a(s,o,r,n,d,"next",e)}function d(e){a(s,o,r,n,d,"throw",e)}n(void 0)}))}}var n={data:function(){return{bargain_id:0,skuId:0,goodsSkuDetail:{goods_id:0,goods_service:[]},shopInfo:{logo:"",shop_baozh:0,shop_qtian:0,shop_zhping:0,shop_erxiaoshi:0,shop_tuihuo:0,shop_shiyong:0,shop_shiti:0,shop_xiaoxie:0},cartCount:0,whetherCollection:0,swiperInterval:1,swiperAutoplay:!1,swiperCurrent:1,switchMedia:"img",isIphoneX:!1,poster:"-1",posterMsg:"",posterHeight:0,goodsEvaluate:{member_headimg:"",member_name:"",content:"",images:[],create_time:0,sku_name:""},memberId:0,contactData:{title:"",path:"",img:""},detailTab:0,service:null,showKefu:0,goodsCircle:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1}}},onLoad:function(t){var i=this;if(this.bargain_id=t.bargain_id||0,this.isIphoneX=this.$util.uniappIsIPhoneX(),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(t){-1!=t.indexOf("bargain_id")&&(i.bargain_id=t.split("-")[1]),-1!=t.indexOf("source_member")&&e.setStorageSync("source_member",t.split("-")[1])}))}},onShow:function(){var t=this;return s(r().mark((function i(){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$langConfig.refresh(),t.$store.dispatch("getAddonIsexit").then(function(){var i=s(r().mark((function i(o){return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o.bargain){i.next=5;break}t.$util.showToast({title:"砍价未开启",mask:!0}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),1e3),i.next=12;break;case 5:return e.getStorageSync("token")&&(t.getCartCount(),t.getMemberId()),t.canGoConnect(),t.getKekuConfig(),i.next=10,t.getGoodsSkuDetail();case 10:t.modifyGoodsInfo(),t.getEvaluateConfig();case 12:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());case 2:case"end":return i.stop()}}),i)})))()},methods:{canGoConnect:function(){var e=this;this.$api.sendRequest({url:"/api/addon/addonisexit",success:function(t){0==t.code&&t.data&&(e.showKefu=t.data.servicer)}})},goConnect:function(){if(e.getStorageSync("token")){var t={site_id:this.shopInfo.site_id,sku_id:this.goodsSkuDetail.sku_id,type:"bargain",type_id:this.goodsSkuDetail.bargain_id};return this.$util.redirectTo("/otherpages/chat/room/room",t),!1}this.$refs.login.open("/pages/goods/detail/detail?sku_id="+this.goodsSkuDetail.sku_id)},getGoodsSkuDetail:function(){var t=this;return s(r().mark((function i(){var o,a,s,n,d;return r().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$api.sendRequest({url:"/bargain/api/goods/detail",async:!1,data:{bargain_id:t.bargain_id}});case 2:if(o=i.sent,a=o.data,null!=a.goods_sku_detail){if(t.goodsSkuDetail=a.goods_sku_detail,t.shopInfo=a.shop_info,t.goodsSkuDetail.stock=t.goodsSkuDetail.bargain_stock,t.skuId=t.goodsSkuDetail.sku_id,t.goodsSkuDetail.goods_service=[],1==t.shopInfo.shop_baozh&&t.goodsSkuDetail.goods_service.push({service_name:"保证服务",desc:"保证服务"}),1==t.shopInfo.shop_qtian&&t.goodsSkuDetail.goods_service.push({service_name:"7天退换",desc:"满足7天无理由退换货申请的前提下，包邮商品需要买家承担退货邮费，非包邮商品需要买家承担发货和退货邮费"}),1==t.shopInfo.shop_zhping&&t.goodsSkuDetail.goods_service.push({service_name:"正品保障",desc:"商品支持正品保障服务"}),1==t.shopInfo.shop_erxiaoshi&&t.goodsSkuDetail.goods_service.push({service_name:"两小时发货",desc:"付款后2小时内发货"}),1==t.shopInfo.shop_tuihuo&&t.goodsSkuDetail.goods_service.push({service_name:"退货承诺",desc:"退货承诺"}),1==t.shopInfo.shop_shiyong&&t.goodsSkuDetail.goods_service.push({service_name:"试用中心",desc:"试用中心"}),1==t.shopInfo.shop_shiti&&t.goodsSkuDetail.goods_service.push({service_name:"实体验证",desc:"实体验证"}),1==t.shopInfo.shop_xiaoxie&&t.goodsSkuDetail.goods_service.push({service_name:"消协保证",desc:"如有商品质量问题、描述不符或未收到货等，您有权申请退款或退货，来回邮费由卖家承担"}),t.goodsSkuDetail.end_time-o.timestamp>0?t.goodsSkuDetail.timeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-o.timestamp):(t.$util.showToast({title:"活动已结束"}),setTimeout((function(){t.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.goodsSkuDetail.sku_id},"redirectTo")}),1e3)),t.goodsSkuDetail.video_url&&(t.switchMedia="video"),t.goodsSkuDetail.sku_images?t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.split(","):t.goodsSkuDetail.sku_images=[],t.goodsSkuDetail.goods_spec_format&&t.goodsSkuDetail.goods_image&&(t.goodsSkuDetail.goods_image=t.goodsSkuDetail.goods_image.split(","),t.goodsSkuDetail.sku_images=t.goodsSkuDetail.sku_images.concat(t.goodsSkuDetail.goods_image)),t.goodsSkuDetail.unit=t.goodsSkuDetail.unit||"件",t.goodsSkuDetail.show_price=t.goodsSkuDetail.floor_price,t.goodsSkuDetail.save_price=t.goodsSkuDetail.price-t.goodsSkuDetail.show_price>0?(t.goodsSkuDetail.price-t.goodsSkuDetail.show_price).toFixed(2):0,t.goodsSkuDetail.sku_spec_format&&(t.goodsSkuDetail.sku_spec_format=JSON.parse(t.goodsSkuDetail.sku_spec_format)),t.goodsSkuDetail.goods_attr_format)for(s=JSON.parse(t.goodsSkuDetail.goods_attr_format),t.goodsSkuDetail.goods_attr_format=t.$util.unique(s,"attr_id"),n=0;n<t.goodsSkuDetail.goods_attr_format.length;n++)for(d=0;d<s.length;d++)t.goodsSkuDetail.goods_attr_format[n].attr_id==s[d].attr_id&&t.goodsSkuDetail.goods_attr_format[n].attr_value_id!=s[d].attr_value_id&&(t.goodsSkuDetail.goods_attr_format[n].attr_value_name+="、"+s[d].attr_value_name);t.goodsSkuDetail.goods_spec_format&&(t.goodsSkuDetail.goods_spec_format=JSON.parse(t.goodsSkuDetail.goods_spec_format)),t.$langConfig.title(t.goodsSkuDetail.goods_name),t.contactData={title:t.goodsSkuDetail.sku_name,path:"/promotionpages/bargain/detail/detail?bargain_id="+t.bargain_id,img:t.$util.img(t.goodsSkuDetail.sku_image,{size:"big"})},e.getStorageSync("token")&&t.getWhetherCollection(),t.setWechatShare(),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.getGoodScircleConfig()}else t.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 5:case"end":return i.stop()}}),i)})))()},refreshGoodsSkuDetail:function(e){var t=this;Object.assign(this.goodsSkuDetail,e),this.goodsSkuDetail.unit=this.goodsSkuDetail.unit||"件",this.swiperCurrent>this.goodsSkuDetail.sku_images.length&&(this.swiperAutoplay=!0,this.swiperCurrent=1,setTimeout((function(){t.swiperAutoplay=!1}),40))},goHome:function(){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:this.shopInfo.site_id})},goCart:function(){this.$util.redirectTo("/pages/goods/cart/cart",{},"reLaunch")},bargain:function(){var t=this;e.getStorageSync("token")?this.goodsSkuDetail.sku_spec_format?this.$refs.goodsSku.show("bargain",(function(){})):this.$api.sendRequest({url:"/bargain/api/bargain/launch",data:{id:this.goodsSkuDetail.id},success:function(e){0==e.code?t.$util.redirectTo("/promotionpages/bargain/launch/launch",{id:e.data},"redirectTo"):t.$util.showToast({title:e.message})}}):this.$refs.login.open("/promotionpages/bargain/detail/detail?bargain_id="+this.bargain_id)},swiperChange:function(e){this.swiperCurrent=e.detail.current+1},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},getGoodsEvaluate:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/firstinfo",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){var i=t.data;i&&(e.goodsEvaluate=i,e.goodsEvaluate.images&&(e.goodsEvaluate.images=e.goodsEvaluate.images.split(",")),1==e.goodsEvaluate.is_anonymous&&(e.goodsEvaluate.member_name=e.goodsEvaluate.member_name.replace(e.goodsEvaluate.member_name.substring(1,e.goodsEvaluate.member_name.length-1),"***")))}})},previewEvaluate:function(t,i){for(var o=[],r=0;r<this.goodsEvaluate[i].length;r++)o.push(this.$util.img(this.goodsEvaluate[i][r]));e.previewImage({current:t,urls:o})},getWhetherCollection:function(){var e=this;this.$api.sendRequest({url:"/api/goodscollect/iscollect",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){e.whetherCollection=t.data}})},editCollection:function(){var t=this;e.getStorageSync("token")?0==this.whetherCollection?this.$api.sendRequest({url:"/api/goodscollect/add",data:{sku_id:this.skuId},success:function(e){var i=e.data;i>0&&(t.whetherCollection=1)}}):this.$api.sendRequest({url:"/api/goodscollect/delete",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(e){var i=e.data;i>0&&(t.whetherCollection=0)}}):this.$refs.login.open("/promotionpages/bargain/detail/detail?bargain_id="+this.bargain_id)},getCartCount:function(){var e=this;this.$store.dispatch("getCartNumber").then((function(t){e.cartCount=t}))},modifyGoodsInfo:function(){this.$api.sendRequest({url:"/api/goods/modifyclicks",data:{sku_id:this.skuId,site_id:this.goodsSkuDetail.site_id},success:function(e){}}),this.$api.sendRequest({url:"/api/goodsbrowse/add",data:{sku_id:this.skuId},success:function(e){}})},openSharePopup:function(){this.$refs.sharePopup.open()},closeSharePopup:function(){this.$refs.sharePopup.close()},openPosterPopup:function(){var t=this;this.getGoodsPoster(),this.$refs.sharePopup.close(),this.$refs.posterPopup.open(),"-1"!=this.poster&&setTimeout((function(){var i=e.createSelectorQuery().in(t).select(".poster-layer .image-wrap");i.fields({size:!0},(function(i){var o=i.width,r=parseFloat((740/o).toFixed(2));e.getStorageSync("token")?t.posterHeight=parseInt(1120/r):t.posterHeight=parseInt(1100/r)})).exec()}),100)},closePosterPopup:function(){this.$refs.posterPopup.close()},getGoodsPoster:function(){var e=this,t={sku_id:this.skuId,id:this.goodsSkuDetail.id};this.memberId&&(t.source_member=this.memberId),this.$api.sendRequest({url:"/bargain/api/goods/poster",data:{page:"/promotionpages/bargain/detail/detail",qrcode_param:JSON.stringify(t)},success:function(t){0==t.code?e.poster=t.data.path+"?time="+(new Date).getTime():e.posterMsg=t.message}})},previewMedia:function(t){for(var i=[],o=0;o<this.goodsSkuDetail.sku_images.length;o++)i.push(this.$util.img(this.goodsSkuDetail.sku_images[o],{size:"big"}));e.previewImage({current:t,urls:i})},swiperImgError:function(e){this.goodsSkuDetail.sku_images[e]=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},saveGoodsPoster:function(){var t=this,i=this.$util.img(this.poster);e.downloadFile({url:i,success:function(i){200===i.statusCode&&e.saveImageToPhotosAlbum({filePath:i.tempFilePath,success:function(){t.$util.showToast({title:"保存成功"})},fail:function(){t.$util.showToast({title:"保存失败，请稍后重试"})}})}})},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getService:function(){var e=this;this.$api.sendRequest({url:"/api/goods/aftersale",success:function(t){if(0==t.code&&t.data){t.data.content;t.data.content&&(e.service=(0,o.default)(t.data.content))}}})},setWechatShare:function(){},getGoodScircleConfig:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/config/info",success:function(t){0==t.code&&t.data.is_use&&e.goodsSyncToGoodsCircle()}})},goodsSyncToGoodsCircle:function(){var e=this;this.$api.sendRequest({url:"/goodscircle/api/goods/sync",data:{goods_id:this.goodsSkuDetail.goods_id},success:function(t){0==t.code&&(e.goodsCircle=!0)}})},openBusinessView:function(){var e=this;wx.openBusinessView&&wx.openBusinessView({businessType:"friendGoodsRecommend",extraData:{product:{item_code:this.goodsSkuDetail.goods_id,title:this.goodsSkuDetail.sku_name,image_list:this.goodsSkuDetail.sku_images.map((function(t){return e.$util.img(t)}))}},success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var i=t.data;e.evaluateConfig=i,1==e.evaluateConfig.evaluate_show&&e.getGoodsEvaluate()}}})},copyUrl:function(){var e=this,t=this.$config.h5Domain+"/promotionpages/bargain/detail/detail?bargain_id="+this.bargain_id;this.memberId&&(t+="&source_member="+this.memberId),this.$util.copy(t,(function(){e.closeSharePopup()}))},getKekuConfig:function(){var e=this;this.$api.sendRequest({url:"/api/config/servicer",success:function(t){0==t.code&&(e.kefuConfig=t.data)}})},toEvaluateDetail:function(e){this.$util.redirectTo("/otherpages/goods/evaluate/evaluate",{goods_id:e})},navigate:function(e,t){this.$util.redirectTo("/otherpages/webview/webview",{link:encodeURIComponent(e)})},openVideo:function(e,t){this.$util.redirectTo("/otherpages/goods/preview-video",{video_url:e,video_img:t})},errorShopLogo:function(){this.shopInfo.avatar=this.$util.getDefaultImage().default_shop_img,this.$forceUpdate()}}};t.default=n}).call(this,i("543d")["default"])},e978:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{isIphoneX:!1,orderCreateData:{is_balance:0,pay_password:""},orderPaymentData:{member_account:{balance:0,is_pay_password:0},shop_goods_list:{site_name:"",express_type:[],invoice_config:{invoice_status:0}},topic_info:{}},orderInvoice:{is_invoice:0,invoice_type:1,invoice_title:"",invoice_title_type:1,invoice_full_address:"",is_tax_invoice:0,invoice_email:"",invoice_content:"",taxpayer_number:""},isSub:!1,tempData:null,siteDelivery:{site_id:0,data:[]}}},methods:{openPopup:function(e){this.$refs[e].open()},closePopup:function(e){this.tempData&&(Object.assign(this.orderCreateData,this.tempData),Object.assign(this.orderPaymentData,this.tempData),this.tempData=null,this.$forceUpdate()),this.$refs[e].close()},selectAddress:function(){this.$util.redirectTo("/otherpages/member/address/address",{back:"/promotionpages/topics/payment/payment",local:0,type:1})},getOrderPaymentData:function(){var t=this;this.orderCreateData=e.getStorageSync("topicOrderCreateData");var i=e.getStorageSync("pay_flag");if(this.orderCreateData){var o=e.getStorageSync("location");o&&(this.orderCreateData=Object.assign(this.orderCreateData,o)),this.orderCreateData.buyer_message="",this.$api.sendRequest({url:"/topic/api/ordercreate/payment",data:this.orderCreateData,success:function(e){e.code>=0?(t.orderPaymentData=e.data,t.orderPaymentData.timestamp=e.timestamp,t.handlePaymentData(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()):(t.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})}else 1==i?e.removeStorageSync("pay_flag"):(this.$util.showToast({title:"未获取到创建订单所需数据！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))},handlePaymentData:function(){this.orderCreateData.delivery={},this.orderCreateData.invoice={},this.orderCreateData.is_balance=0,this.orderCreateData.pay_password="";var e=this.orderPaymentData,t=(new Date).getHours().toString(),i=(new Date).getMinutes().toString();1==t.length&&(t="0"+t),1==i.length&&(i="0"+i);var o=t+":"+i,r=["周日","周一","周二","周三","周四","周五","周六"],a=["0","1","2","3","4","5","6"][(new Date).getDay()];if(void 0!=e.shop_goods_list.express_type&&void 0!=e.shop_goods_list.express_type[0]){var s=e.shop_goods_list.express_type;this.orderCreateData.delivery.delivery_type=s[0].name,this.orderCreateData.delivery.delivery_type_name=s[0].title,this.orderCreateData.delivery.store_id=0,"store"==s[0].name&&void 0!=s[0].store_list[0]&&(this.orderCreateData.delivery.store_id=s[0].store_list[0].store_id)}if(0==e.is_virtual&&e.shop_goods_list.local_config)if(e.shop_goods_list.local_config.info&&1==e.shop_goods_list.local_config.info.time_is_open){if(this.orderCreateData.delivery.showTimeBar=!0,this.orderCreateData.delivery.buyer_ask_delivery_time=o,0==e.shop_goods_list.local_config.info.time_week.length||7==e.shop_goods_list.local_config.info.time_week.length||e.shop_goods_list.local_config.info.time_week.indexOf(a)>-1?this.orderCreateData.delivery.canLocalDelicery=!0:this.orderCreateData.delivery.canLocalDelicery=!1,0==e.shop_goods_list.local_config.info.time_type)this.orderCreateData.delivery.deliveryWeek="全天";else if(e.shop_goods_list.local_config.info.time_week.length>0)if(7==e.shop_goods_list.local_config.info.time_week.length)this.orderCreateData.delivery.deliveryWeek="全天",this.orderCreateData.delivery.showTime=!1;else{this.orderCreateData.delivery.showTime=!0;for(var n=e.shop_goods_list.local_config.info.time_week,d=!1,c=0;c<n.length;c++)if(c+1<n.length){var l=n[c+1]-n[c];if(l>1){d=!0;break}}if(d){var u=[];for(c=0;c<n.length;c++)u.push(r[n[c]]);this.orderCreateData.delivery.deliveryWeek=u.join("、")}else this.orderCreateData.delivery.deliveryWeek=r[n[0]]+"至"+r[n[n.length-1]]}else this.orderCreateData.delivery.deliveryWeek="店铺未设置配送时间";var h=e.shop_goods_list.local_config.info.start_time;this.orderCreateData.delivery.start_time=this.getTimeStr(h);var p=e.shop_goods_list.local_config.info.end_time;this.orderCreateData.delivery.end_time=this.getTimeStr(p);var _=new Date(this.$util.timeStampTurnTime(e.timestamp)),g=_.getHours(),f=_.getMinutes(),v=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),m=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),y=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),D=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);this.orderCreateData.delivery.canLocalDelicery&&(v==y&&m==D||((g<v||g==v&&f<m)&&(this.orderCreateData.delivery.buyer_ask_delivery_time=(1==v.toString().length?"0"+v:v)+":"+(1==m.toString().length?"0"+m:m)),(g>y||g==y&&f>D)&&(this.orderCreateData.delivery.canLocalDelicery=!1)))}else this.orderCreateData.delivery.showTimeBar=!1,this.orderCreateData.delivery.deliveryWeek="店铺未开启配送时间";e.shop_goods_list.goods_list.forEach((function(e){"string"==typeof e.sku_spec_format&&(e.sku_spec_format?e.sku_spec_format=JSON.parse(e.sku_spec_format):e.sku_spec_format=[])})),this.orderPaymentData.is_virtual&&(this.orderCreateData.member_address={mobile:""}),Object.assign(e,this.orderCreateData),this.orderCalculate()},getTimeStr:function(e){var t=parseInt(e/3600).toString(),i=parseInt(e%3600/60).toString();return 1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),t+":"+i},orderCalculate:function(){var e=this,t=this.orderPaymentData.shop_goods_list.site_id,i={};i[t]=this.orderCreateData.delivery;var o={};o[t]=this.orderCreateData.buyer_message,this.orderPaymentData.shop_goods_list.is_invoice&&(this.orderCreateData.invoice[t]={},Array.isArray(this.orderPaymentData.shop_goods_list.invoice_config)||(this.orderCreateData.invoice[t].is_invoice=this.orderPaymentData.shop_goods_list.is_invoice,this.orderCreateData.invoice[t].invoice_type=this.orderPaymentData.shop_goods_list.invoice_type,this.orderCreateData.invoice[t].invoice_title=this.orderPaymentData.shop_goods_list.invoice_title,this.orderCreateData.invoice[t].taxpayer_number=this.orderPaymentData.shop_goods_list.taxpayer_number,this.orderCreateData.invoice[t].invoice_content=this.orderPaymentData.shop_goods_list.invoice_content,this.orderCreateData.invoice[t].invoice_full_address=this.orderPaymentData.shop_goods_list.invoice_full_address,this.orderCreateData.invoice[t].is_tax_invoice=this.orderPaymentData.shop_goods_list.is_tax_invoice,this.orderCreateData.invoice[t].invoice_email=this.orderPaymentData.shop_goods_list.invoice_email,this.orderCreateData.invoice[t].invoice_title_type=this.orderPaymentData.shop_goods_list.invoice_title_type));var r=this.$util.deepClone(this.orderCreateData);r.delivery=JSON.stringify(i),r.invoice=JSON.stringify(r.invoice),r.member_address=JSON.stringify(r.member_address),r.buyer_message=JSON.stringify(o),this.$api.sendRequest({url:"/topic/api/ordercreate/calculate",data:r,success:function(t){t.code>=0?(e.orderPaymentData.member_address=t.data.member_address,e.orderPaymentData.delivery_money=t.data.delivery_money,e.orderPaymentData.invoice_money=t.data.invoice_money,e.orderPaymentData.invoice_delivery_money=t.data.invoice_delivery_money,e.orderPaymentData.promotion_money=t.data.promotion_money,e.orderPaymentData.order_money=t.data.order_money,e.orderPaymentData.balance_money=t.data.balance_money,e.orderPaymentData.pay_money=t.data.pay_money,e.orderPaymentData.goods_money=t.data.goods_money,e.$forceUpdate()):e.$util.showToast({title:t.message})}})},orderCreate:function(t){var i=this;if(this.verify()){if(this.isSub)return;this.isSub=!0,t&&(this.orderCreateData.pay_password=t);var o=this.orderPaymentData.shop_goods_list.site_id,r={};r[o]=this.orderCreateData.delivery;var a={};a[o]=this.orderCreateData.buyer_message;var s=this.$util.deepClone(this.orderCreateData);s.delivery=JSON.stringify(r),s.invoice=JSON.stringify(s.invoice),s.member_address=JSON.stringify(s.member_address),s.buyer_message=JSON.stringify(a),this.$api.sendRequest({url:"/topic/api/ordercreate/create",data:s,success:function(t){e.hideLoading(),t.code>=0?0==i.orderPaymentData.pay_money?i.$util.redirectTo("/pages/pay/result/result",{code:t.data},"redirectTo"):(i.$refs.choosePaymentPopup.getPayInfo(t.data),i.isSub=!1):(i.isSub=!1,10==t.data.error_code||12==t.data.error_code?e.showModal({title:"订单未创建",content:t.message,confirmText:"去设置",success:function(e){e.confirm&&i.selectAddress()}}):i.$util.showToast({title:t.message}))},fail:function(t){e.hideLoading(),i.isSub=!1}})}},verify:function(){if(1==this.orderPaymentData.is_virtual){if(!this.orderCreateData.member_address.mobile.length)return this.$util.showToast({title:"请输入您的手机号码"}),!1;if(!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(this.orderCreateData.member_address.mobile))return this.$util.showToast({title:"请输入正确的手机号码"}),!1}if(0==this.orderPaymentData.is_virtual){var e=!0;for(var t in this.orderPaymentData.shop_goods_list)if(0==this.orderPaymentData.shop_goods_list.express_type.length){e=!1,this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"});break}if(!e)return!1;if(!this.orderPaymentData.member_address)return this.$util.showToast({title:"请先选择您的收货地址"}),!1;if("{}"==JSON.stringify(this.orderCreateData.delivery))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】未设置配送方式"}),!1;if("store"==this.orderCreateData.delivery.delivery_type&&0==this.orderCreateData.delivery.store_id)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】没有可提货的门店,请选择其他配送方式"}),!1;if("local"==this.orderCreateData.delivery.delivery_type){if(!this.orderCreateData.delivery.canLocalDelicery)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】已休息"}),!1;var i=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[0]),o=parseInt(this.orderCreateData.delivery.buyer_ask_delivery_time.split(":")[1]),r=parseInt(this.orderCreateData.delivery.start_time.split(":")[0]),a=parseInt(this.orderCreateData.delivery.start_time.split(":")[1]),s=parseInt(this.orderCreateData.delivery.end_time.split(":")[0]),n=parseInt(this.orderCreateData.delivery.end_time.split(":")[1]);if(r!=s||a!=n){if(i<r||i==r&&o<a)return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间不能小于配送开始时间"}),!1;if(!(i>r&&i<s||i==r&&o>a||i==r&&o>=a&&i<s))return this.$util.showToast({title:'店铺【"'+this.orderPaymentData.shop_goods_list.site_name+"】送达时间范围：开始时间~结束时间"}),!1}}}return!0},openSitePromotion:function(){this.$refs.sitePromotionPopup.open()},openSiteDelivery:function(){this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},this.$refs.deliveryPopup.open()},selectDeliveryType:function(e){this.orderCreateData.delivery.delivery_type=e.name,this.orderCreateData.delivery.delivery_type_name=e.title,this.tempData={delivery:this.$util.deepClone(this.orderPaymentData.delivery)},"store"==e.name&&void 0!=e.store_list[0]&&(this.orderCreateData.delivery.store_id=e.store_list[0].store_id,this.tempData.delivery.store_id=e.store_list[0].store_id),Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate()},selectPickupPoint:function(e){this.orderCreateData.delivery.store_id=e,Object.assign(this.orderPaymentData,this.orderCreateData),this.orderCalculate(),this.$forceUpdate(),this.$refs["deliveryPopup"].close()},useBalance:function(){this.orderCreateData.is_balance?this.orderCreateData.is_balance=0:this.orderCreateData.is_balance=1,this.orderCalculate(),this.$forceUpdate()},imgError:function(e){this.orderPaymentData.shop_goods_list.goods_list[e].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},openInvoicePopup:function(e){this.orderInvoice=this.$util.deepClone(e),this.orderInvoice.invoice_type=void 0==this.orderInvoice.invoice_type?1:this.orderInvoice.invoice_type,this.orderInvoice.invoice_title_type=void 0==this.orderInvoice.invoice_title_type?1:this.orderInvoice.invoice_title_type,this.orderInvoice.invoice_content=this.orderInvoice.invoice_content?this.orderInvoice.invoice_content:"",this.orderInvoice.invoice_title=this.orderInvoice.invoice_title?this.orderInvoice.invoice_title:"",this.orderInvoice.invoice_full_address=this.orderInvoice.invoice_full_address?this.orderInvoice.invoice_full_address:"",this.orderInvoice.is_tax_invoice=this.orderInvoice.is_tax_invoice?this.orderInvoice.is_tax_invoice:0,this.orderInvoice.invoice_email=this.orderInvoice.invoice_email?this.orderInvoice.invoice_email:"",this.orderInvoice.taxpayer_number=this.orderInvoice.taxpayer_number?this.orderInvoice.taxpayer_number:"",this.openPopup("invoicePopup")},changeIsInvoice:function(){0==this.orderInvoice.is_invoice?this.orderInvoice.is_invoice=1:this.orderInvoice.is_invoice=0,this.$forceUpdate()},changeInvoiceType:function(e){this.orderInvoice.invoice_type=e,this.$forceUpdate()},changeInvoiceTitleType:function(e){this.orderInvoice.invoice_title_type=e,this.$forceUpdate()},changeInvoiceContent:function(e){this.orderInvoice.invoice_content=e,this.$forceUpdate()},closeInvoicePopup:function(){this.orderInvoice.invoice_type=1,this.orderInvoice.invoice_title_type=1,this.orderInvoice.invoice_content="",this.orderInvoice.invoice_title="",this.orderInvoice.invoice_full_address="",this.orderInvoice.is_tax_invoice=0,this.orderInvoice.invoice_email="",this.orderInvoice.taxpayer_number="",this.orderCalculate(),this.$forceUpdate(),this.$refs.invoicePopup.close()},invoiceVerify:function(){if(1==this.orderInvoice.is_invoice){if(""==this.orderInvoice.invoice_title)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票抬头"}),!1;if(2==this.orderInvoice.invoice_title_type&&""==this.orderInvoice.taxpayer_number)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写纳税人识别号"}),!1;if(1==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_full_address)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写发票邮寄地址"}),!1;if(2==this.orderInvoice.invoice_type&&""==this.orderInvoice.invoice_email)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写邮箱"}),!1;if(2==this.orderInvoice.invoice_type&&""!=this.orderInvoice.invoice_email){if(!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.orderInvoice.invoice_email))return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请填写正确的邮箱地址"}),!1}if(""==this.orderInvoice.invoice_content)return this.$refs.invoicePopup.open(),this.$util.showToast({title:"请选择发票内容"}),!1}return!0},saveInvoice:function(){this.invoiceVerify()&&(this.orderPaymentData.shop_goods_list=this.orderInvoice,this.orderCalculate(),this.closePopup("invoicePopup"))},bindTimeChange:function(e){var t=e.target.value;this.orderCreateData.delivery[e.currentTarget.dataset.siteid].buyer_ask_delivery_time=t,this.orderCalculate(),this.$forceUpdate()},toShopDetail:function(e){this.$util.redirectTo("/otherpages/shop/index/index",{site_id:e})},navigateTo:function(e){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:e})},openChoosePayment:function(){e.setStorageSync("paySource",""),this.verify()&&this.$refs.choosePaymentPopup.open()}},onShow:function(){this.$langConfig.refresh(),e.getStorageSync("addressBack")&&e.removeStorageSync("addressBack"),e.getStorageSync("token")?this.getOrderPaymentData():this.$util.redirectTo("/pages/login/login/login"),this.isIphoneX=this.$util.uniappIsIPhoneX()},onHide:function(){this.$refs.loadingCover&&this.$refs.loadingCover.show()},computed:{balanceDeduct:function(){return this.orderPaymentData.member_account.balance_total<=parseFloat(this.orderPaymentData.order_money).toFixed(2)?parseFloat(this.orderPaymentData.member_account.balance_total).toFixed(2):parseFloat(this.orderPaymentData.order_money).toFixed(2)}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,i("543d")["default"])}}]);