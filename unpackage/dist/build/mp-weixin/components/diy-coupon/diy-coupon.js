(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/diy-coupon/diy-coupon"],{"2b0b":function(t,o,n){"use strict";n.r(o);var e=n("f946"),u=n("99b8");for(var i in u)["default"].indexOf(i)<0&&function(t){n.d(o,t,(function(){return u[t]}))}(i);n("6c13"),n("3f07");var s=n("f0c5"),c=Object(s["a"])(u["default"],e["b"],e["c"],!1,null,"683ca5f1",null,!1,e["a"],void 0);o["default"]=c.exports},"3f07":function(t,o,n){"use strict";var e=n("ddfd"),u=n.n(e);u.a},5028:function(t,o,n){},"6c13":function(t,o,n){"use strict";var e=n("5028"),u=n.n(e);u.a},"99b8":function(t,o,n){"use strict";n.r(o);var e=n("cfb0"),u=n.n(e);for(var i in e)["default"].indexOf(i)<0&&function(t){n.d(o,t,(function(){return e[t]}))}(i);o["default"]=u.a},cfb0:function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=function(t){return t&&t.__esModule?t:{default:t}}(n("a88e"));var u={name:"diy-coupon",props:{value:{type:Object,default:function(){return{}}},siteId:{type:[Number,String],default:0}},mixins:[e.default],data:function(){return{token:"",couponList:[],isHave:!0,couponBtnSwitch:!1,couponTab:1}},created:function(){this.getCanReceiveCouponQuery()},computed:{computedCouponList:function(){var t=[];return this.couponList.filter((function(o){o.count!=o.lead_count&&t.push(o)})),t}},methods:{couponTap:function(t,o){t.count!=t.lead_count?0==t.useState?this.receiveCoupon(t,o):this.toGoodList(t):this.$util.showToast({title:"该优惠券已抢光"})},getCanReceiveCouponQuery:function(){var t,o=this;this.couponTab=this.siteId?0:1,t=0==this.couponTab?"/coupon/api/coupon/typepagelists":"/platformcoupon/api/platformcoupon/typepagelists";"diy"==this.value.sources&&(0,this.value.couponIds&&this.value.couponIds.split(",")),this.$api.sendRequest({url:t,data:{page:1,page_size:10,site_id:this.siteId,coupon_type_id_arr:this.value.couponIds},success:function(t){var n=t.data;null!=n&&(o.couponList=n.list,o.couponList.forEach((function(t){t.useState=0})))}})},receiveCoupon:function(o,n){var e=this;if(!this.couponBtnSwitch){this.couponBtnSwitch=!0;var u=t.getStorageSync("token");if(""!=u){var i,s={site_id:o.site_id,get_type:2};0==this.couponTab?(i="/coupon/api/coupon/receive",s.coupon_type_id=o.coupon_type_id):(i="/platformcoupon/api/platformcoupon/receive",s.platformcoupon_type_id=o.platformcoupon_type_id),this.$api.sendRequest({url:i,data:s,success:function(t){t.data;var n=t.message;0==t.code&&(n="领取成功");var u=e.couponList;if(0==e.couponTab)if(1==t.data.is_exist)for(var i=0;i<u.length;i++)u[i].coupon_type_id==o.coupon_type_id&&(u[i].useState=1);else for(var s=0;s<u.length;s++)u[s].coupon_type_id==o.coupon_type_id&&(u[s].useState=2);else if(1==t.data.is_exist)for(var c=0;c<u.length;c++)u[c].platformcoupon_type_id==o.platformcoupon_type_id&&(u[c].useState=1);else for(var a=0;a<u.length;a++)u[a].platformcoupon_type_id==o.platformcoupon_type_id&&(u[a].useState=2);e.$util.showToast({title:n}),e.couponBtnSwitch=!1,e.$forceUpdate()},fail:function(t){e.couponBtnSwitch=!1}})}else this.couponBtnSwitch=!1,this.$util.redirectTo("/pages/login/login/login")}},toGoodList:function(t){0==this.couponTab?1!=t.goods_type?this.$util.redirectTo("/otherpages/shop/list/list",{couponId:t.coupon_type_id,site_id:t.site_id}):this.$util.redirectTo("/otherpages/shop/list/list",{site_id:t.site_id}):1!=t.use_scenario?this.$util.redirectTo("/pages/goods/list/list",{platformcouponTypeId:t.platformcoupon_type_id}):this.$util.redirectTo("/pages/goods/list/list",{})}}};o.default=u}).call(this,n("543d")["default"])},ddfd:function(t,o,n){},f946:function(t,o,n){"use strict";n.d(o,"b",(function(){return u})),n.d(o,"c",(function(){return i})),n.d(o,"a",(function(){return e}));var e={nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"8689"))}},u=function(){var t=this,o=t.$createElement,n=(t._self._c,t.$util.img("/upload/uniapp/coupon/style1-bg.png")),e=t.computedCouponList.length>0&&"1"==t.value.style?t.__map(t.computedCouponList,(function(o,n){var e=t.__get_orig(o),u=o.discount&&"0.00"!=o.discount?null:Number(o.money),i=o.discount&&"0.00"!=o.discount?Number(o.discount):null,s=o.at_least>0?Number(o.at_least):null;return{$orig:e,m0:u,m1:i,m2:s}})):null,u=t.$util.img("/upload/uniapp/coupon/"+t.themeStyleScore+"_coupon.png"),i=t.computedCouponList.length>0&&"2"==t.value.style?t.__map(t.computedCouponList,(function(o,n){var e=t.__get_orig(o),u=o.discount&&"0.00"!=o.discount?null:Number(o.money),i=o.discount&&"0.00"!=o.discount?Number(o.discount):null,s=o.at_least>0?Number(o.at_least):null;return{$orig:e,m3:u,m4:i,m5:s}})):null,s=t.$util.img("/upload/uniapp/coupon/coupon_shu.png"),c=t.computedCouponList.length>0&&"3"==t.value.style?t.__map(t.computedCouponList,(function(o,n){var e=t.__get_orig(o),u=o.discount&&"0.00"!=o.discount?null:Number(o.money),i=o.discount&&"0.00"!=o.discount?Number(o.discount):null,s=o.at_least>0?Number(o.at_least):null;return{$orig:e,m6:u,m7:i,m8:s}})):null;t.$mp.data=Object.assign({},{$root:{g0:n,l0:e,g1:u,l1:i,g2:s,l2:c}})},i=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/diy-coupon/diy-coupon-create-component',
    {
        'components/diy-coupon/diy-coupon-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("2b0b"))
        })
    },
    [['components/diy-coupon/diy-coupon-create-component']]
]);
