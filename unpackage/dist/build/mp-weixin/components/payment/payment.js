(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/payment/payment"],{"0f2e":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={name:"payment",components:{uniPopup:function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("fbc8"))}.bind(null,n)).catch(n.oe)},nsSwitch:function(){n.e("components/ns-switch/ns-switch").then(function(){return resolve(n("fddf"))}.bind(null,n)).catch(n.oe)}},props:{balanceDeduct:{type:[Number,String],default:""},isBalance:{type:Number,default:0},payMoney:{type:[Number,String],default:0}},data:function(){return{isIphoneX:!1,payIndex:0,payTypeList:[{name:"微信支付",provider:"wxpay",icon:"iconweixin1",type:"wechatpay"}],payInfo:{}}},created:function(){this.isIphoneX=this.$util.uniappIsIPhoneX(),this.getPayType()},methods:{open:function(){this.$refs.choosePaymentPopup.open()},close:function(){this.$refs.choosePaymentPopup.close()},useBalance:function(){this.$emit("useBalance")},confirm:function(){0==this.payTypeList.length&&this.payMoney>0?this.$util.showToast({title:"请选择支付方式！"}):(e.showLoading({title:"支付中...",mask:!0}),this.$refs.choosePaymentPopup.close(),this.$emit("confirm"),e.setStorageSync("pay_flag",1))},getPayInfo:function(e){var t=this;this.$api.sendRequest({url:"/api/pay/info",data:{out_trade_no:e},success:function(e){e.code>=0&&e.data?(t.payInfo=e.data,t.pay()):(t.$util.showToast({title:"未获取到支付信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1e3))}})},getPayType:function(){var e=this;this.$api.sendRequest({url:"/api/pay/type",success:function(t){0==t.code&&e.payTypeList.forEach((function(n,i){-1==t.data.pay_type.indexOf(n.type)&&e.payTypeList.splice(i,1)}))}})},pay:function(){var t=this,n=this.payTypeList[this.payIndex];n&&"wxpay"==n.provider&&this.$api.sendRequest({url:"/api/pay/pay",data:{out_trade_no:this.payInfo.out_trade_no,pay_type:n.type},success:function(i){if(e.hideLoading(),i.code>=0){var a=i.data.data;e.requestPayment({provider:n.provider,timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:function(e){t.$util.redirectTo("/pages/pay/result/result",{code:t.payInfo.out_trade_no},"","redirectTo")},fail:function(n){t.flag=!1,"requestPayment:fail cancel"==n.errMsg?t.$util.showToast({title:"您已取消支付"}):e.showModal({content:"支付失败,失败原因: "+n.errMsg,showCancel:!1}),setTimeout((function(){t.$util.redirectTo("/pages/pay/result/result",{code:t.payInfo.out_trade_no},"redirectTo")}),1e3)}})}else t.$util.showToast({title:i.message}),setTimeout((function(){t.$util.redirectTo("/pages/pay/result/result",{code:t.payInfo.out_trade_no},"redirectTo")}),1e3)},fail:function(n){e.hideLoading(),t.$util.showToast({title:"request:fail"})}})}},filters:{moneyFormat:function(e){return parseFloat(e).toFixed(2)}}};t.default=i}).call(this,n("543d")["default"])},"2ecc":function(e,t,n){"use strict";n.r(t);var i=n("4920"),a=n("73d8");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("9c14");var s=n("f0c5"),u=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=u.exports},4920:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"fbc8"))},nsSwitch:function(){return n.e("components/ns-switch/ns-switch").then(n.bind(null,"fddf"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e._f("moneyFormat")(e.payMoney));e._isMounted||(e.e0=function(t,n){var i=arguments[arguments.length-1].currentTarget.dataset,a=i.eventParams||i["event-params"];n=a.index;e.payIndex=n}),e.$mp.data=Object.assign({},{$root:{f0:n}})},o=[]},"73d8":function(e,t,n){"use strict";n.r(t);var i=n("0f2e"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"9c14":function(e,t,n){"use strict";var i=n("b74a"),a=n.n(i);a.a},b74a:function(e,t,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/payment/payment-create-component',
    {
        'components/payment/payment-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("2ecc"))
        })
    },
    [['components/payment/payment-create-component']]
]);
